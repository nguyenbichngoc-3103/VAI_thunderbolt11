<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>V-AI - Zalo Mini App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #DBFFF8;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
        }
        .typing-animation {
            animation: typing 1.5s infinite;
        }
        @keyframes typing {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        .message-bubble {
            max-width: 85%;
            word-wrap: break-word;
        }
        .scroll-container {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .scroll-container::-webkit-scrollbar {
            display: none;
        }
        .career-card {
            transition: all 0.3s ease;
        }
        .career-card:active {
            transform: scale(0.95);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .zalo-header {
            background: #DBFFF8;
            color: #333;
            padding: 12px 16px;
            text-align: center;
            font-weight: 600;
            font-size: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #messages {
            max-height: 60vh;
            min-height: 200px;
            overflow-y: auto !important;
            scrollbar-width: thin;
            scrollbar-color: #60a5fa #e5e7eb;
        }
        #messages::-webkit-scrollbar {
            width: 8px;
            background: #e5e7eb;
        }
        #messages::-webkit-scrollbar-thumb {
            background: #60a5fa;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <!-- Career Selection Screen -->
    <div id="careerSelection" class="h-full overflow-y-auto">
        <div class="p-6">
            <!-- Welcome Section -->
            <div class="text-center mb-8 fade-in">
                <div class="bg-white bg-opacity-30 p-6 rounded-3xl mb-6 shadow-lg">
                    <div class="bg-white p-4 rounded-full w-20 h-20 mx-auto mb-4 flex items-center justify-center shadow-md">
                        <img src="boost.png" alt="V-AI Logo" class="min-w-20 min-h-20">
                    </div>
                    <h1 class="text-3xl font-bold text-gray-800 mb-3">V-AI</h1>
                    <p class="text-gray-700 text-lg mb-2">Dễ hiểu - Dễ dùng - Dễ ứng dụng</p>
                </div>
            </div>

            <!-- Career Cards -->
            <div class="grid grid-cols-1 gap-6 w-full max-w-4xl mx-auto">
                <!-- Row 1 -->
                <div class="grid grid-cols-3 gap-6">
                    <!-- Nông dân -->
                    <div class="career-card bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center text-center h-full justify-between cursor-pointer hover:shadow-xl transition-all duration-300" onclick="selectCareer('farmer')">
                        <div class="flex flex-col items-center">
                            <div class="bg-green-100 p-4 rounded-full w-20 h-20 flex items-center justify-center mb-4">
                                <i data-lucide="leaf" class="w-10 h-10 text-green-600"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-800 mb-2">Nông dân</h3>
                            <p class="text-gray-500 text-sm mb-4">Thời tiết, canh tác, sâu bệnh</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-xl w-full">
                            <p class="text-sm text-gray-700 mb-2 font-semibold">Hỗ trợ:</p>
                            <ul class="text-sm text-gray-600 space-y-1 text-left">
                                <li>• Dự báo thời tiết</li>
                                <li>• Kỹ thuật canh tác</li>
                                <li>• Phòng trừ sâu bệnh</li>
                            </ul>
                        </div>
                    </div>
                    <!-- Doanh nhân -->
                    <div class="career-card bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center text-center h-full justify-between cursor-pointer hover:shadow-xl transition-all duration-300" onclick="selectCareer('business')">
                        <div class="flex flex-col items-center">
                            <div class="bg-blue-100 p-4 rounded-full w-20 h-20 flex items-center justify-center mb-4">
                                <i data-lucide="briefcase" class="w-10 h-10 text-blue-600"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-800 mb-2">Doanh nhân</h3>
                            <p class="text-gray-500 text-sm mb-4">Kinh doanh, marketing</p>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-xl w-full">
                            <p class="text-sm text-gray-700 mb-2 font-semibold">Hỗ trợ:</p>
                            <ul class="text-sm text-gray-600 space-y-1 text-left">
                                <li>• Chiến lược kinh doanh</li>
                                <li>• Digital marketing</li>
                                <li>• Phân tích thị trường</li>
                            </ul>
                        </div>
                    </div>
                    <!-- Giáo viên -->
                    <div class="career-card bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center text-center h-full justify-between cursor-pointer hover:shadow-xl transition-all duration-300" onclick="selectCareer('teacher')">
                        <div class="flex flex-col items-center">
                            <div class="bg-purple-100 p-4 rounded-full w-20 h-20 flex items-center justify-center mb-4">
                                <i data-lucide="book-open" class="w-10 h-10 text-purple-600"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-800 mb-2">Giáo viên</h3>
                            <p class="text-gray-500 text-sm mb-4">Giảng dạy, giáo án</p>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-xl w-full">
                            <p class="text-sm text-gray-700 mb-2 font-semibold">Hỗ trợ:</p>
                            <ul class="text-sm text-gray-600 space-y-1 text-left">
                                <li>• Soạn giáo án</li>
                                <li>• Phương pháp dạy</li>
                                <li>• Quản lý lớp học</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <!-- Row 2 -->
                <div class="grid grid-cols-3 gap-6">
                    <!-- Lập trình viên -->
                    <div class="career-card bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center text-center h-full justify-between cursor-pointer hover:shadow-xl transition-all duration-300" onclick="selectCareer('developer')">
                        <div class="flex flex-col items-center">
                            <div class="bg-indigo-100 p-4 rounded-full w-20 h-20 flex items-center justify-center mb-4">
                                <i data-lucide="code" class="w-10 h-10 text-indigo-600"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-800 mb-2">Lập trình viên</h3>
                            <p class="text-gray-500 text-sm mb-4">Coding, debug, framework</p>
                        </div>
                        <div class="bg-indigo-50 p-4 rounded-xl w-full">
                            <p class="text-sm text-gray-700 mb-2 font-semibold">Hỗ trợ:</p>
                            <ul class="text-sm text-gray-600 space-y-1 text-left">
                                <li>• Best practices</li>
                                <li>• Debug & testing</li>
                                <li>• Framework & công nghệ</li>
                            </ul>
                        </div>
                    </div>
                    <!-- Nhân viên bán hàng -->
                    <div class="career-card bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center text-center h-full justify-between cursor-pointer hover:shadow-xl transition-all duration-300" onclick="selectCareer('sales')">
                        <div class="flex flex-col items-center">
                            <div class="bg-orange-100 p-4 rounded-full w-20 h-20 flex items-center justify-center mb-4">
                                <i data-lucide="shopping-cart" class="w-10 h-10 text-orange-600"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-800 mb-2">Nhân viên bán hàng</h3>
                            <p class="text-gray-500 text-sm mb-4">Tư vấn, CSKH, sales</p>
                        </div>
                        <div class="bg-orange-50 p-4 rounded-xl w-full">
                            <p class="text-sm text-gray-700 mb-2 font-semibold">Hỗ trợ:</p>
                            <ul class="text-sm text-gray-600 space-y-1 text-left">
                                <li>• Kỹ năng bán hàng</li>
                                <li>• Chăm sóc khách hàng</li>
                                <li>• Quản lý đơn hàng</li>
                            </ul>
                        </div>
                    </div>
                    <!-- Nhân viên văn phòng -->
                    <div class="career-card bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center text-center h-full justify-between cursor-pointer hover:shadow-xl transition-all duration-300" onclick="selectCareer('office')">
                        <div class="flex flex-col items-center">
                            <div class="bg-teal-100 p-4 rounded-full w-20 h-20 flex items-center justify-center mb-4">
                                <i data-lucide="building" class="w-10 h-10 text-teal-600"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-800 mb-2">Nhân viên văn phòng</h3>
                            <p class="text-gray-500 text-sm mb-4">Hành chính, quản lý</p>
                        </div>
                        <div class="bg-teal-50 p-4 rounded-xl w-full">
                            <p class="text-sm text-gray-700 mb-2 font-semibold">Hỗ trợ:</p>
                            <ul class="text-sm text-gray-600 space-y-1 text-left">
                                <li>• Quản lý tài liệu</li>
                                <li>• Kế hoạch công việc</li>
                                <li>• Công cụ văn phòng</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Other option -->
            <div class="text-center mt-8">
                <button onclick="selectCareer('other')" class="bg-white bg-opacity-80 hover:bg-opacity-100 px-6 py-3 rounded-full text-gray-700 font-medium transition-all duration-300 shadow-lg hover:shadow-xl">
                    <i data-lucide="more-horizontal" class="w-5 h-5 inline mr-2"></i>
                    Nghề khác
                </button>
            </div>
        </div>
    </div>

    <!-- Main App (Hidden initially) -->
    <div id="mainApp" class="hidden h-full flex flex-col">
        <!-- Info Bar -->
        <div class="bg-white shadow-sm p-4 text-center">
            <div class="flex items-center justify-between">
                <button onclick="changeCareer()" class="text-gray-600 hover:text-gray-800 p-2 rounded-full hover:bg-gray-100">
                    <i data-lucide="arrow-left" class="w-5 h-5"></i>
                </button>
                <div>
                    <h2 class="text-gray-800 font-semibold text-lg" id="careerTitle">Trợ lý AI</h2>
                    <p class="text-gray-500 text-sm" id="userInfo">Chào mừng bạn!</p>
                </div>
                <button onclick="shareApp()" class="text-gray-600 hover:text-gray-800 p-2 rounded-full hover:bg-gray-100">
                    <i data-lucide="share" class="w-5 h-5"></i>
                </button>
            </div>
        </div>

        <!-- Chat Interface -->
        <div class="flex-1 flex flex-col bg-white">
            <!-- Messages -->
            <div id="messages" class="flex-1 overflow-y-auto p-4 space-y-4 scroll-container">
                <!-- Messages will be added here -->
            </div>

            <!-- Input -->
            <div class="p-4 bg-white border-t">
                <div class="flex space-x-3">
                    <input
                        type="text"
                        id="messageInput"
                        placeholder="Nhập câu hỏi của bạn..."
                        class="flex-1 px-4 py-3 border border-gray-200 rounded-full bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-800"
                        onkeypress="handleKeyPress(event)"
                    />
                    <button
                        onclick="sendMessage()"
                        id="sendButton"
                        class="px-6 py-3 bg-blue-500 text-white rounded-full hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm"
                    >
                        <i data-lucide="send" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        let currentCareer = '';
        let isTyping = false;
        let userProfile = JSON.parse(localStorage.getItem('userProfile')) || {};

        console.log('Script initialized'); // Debug log
        console.log('userProfile:', userProfile); // Debug log
        console.log('currentCareer:', currentCareer); // Debug log

        // Career-specific AI responses
        const careerResponses = {
            farmer: {
                title: "NôngTrí AI",
                greeting: [
                    "Chào chú/cô! Cháu là NôngTrí, chuyên gia nông nghiệp đây ạ! 🌱\n\nCháu có thể giúp chú/cô với:\n• Thông tin thời tiết chi tiết\n• Kỹ thuật canh tác hiện đại\n• Phòng trừ sâu bệnh\n• Dự báo giá nông sản\n• Nhắc nhở công việc hàng ngày\n\nChú/cô cần cháu hỗ trợ gì hôm nay ạ?",
                    "Xin chào! Cháu NôngTrí đây ạ! Sẵn sàng hỗ trợ chú/cô trong công việc nông nghiệp. Chú/cô có thể hỏi cháu về thời tiết, kỹ thuật trồng trọt, chăn nuôi, hoặc bất kỳ vấn đề nào khác nhé!"
                ],
                askDetail: "Để cháu có thể hỗ trợ tốt hơn, chú/cô có thể cho cháu biết:\n• Chú/cô đang trồng loại cây gì?\n• Diện tích canh tác của chú/cô?\n• Chú/cô đã làm nông nghiệp được bao lâu?",
                followUpQuestions: [
                    "Chú/cô đang trồng loại cây gì?",
                    "Diện tích canh tác của chú/cô là bao nhiêu?",
                    "Chú/cô gặp khó khăn gì về sâu bệnh?",
                    "Chú/cô muốn tăng năng suất như thế nào?",
                    "Thời tiết hiện tại ảnh hưởng gì đến cây trồng?",
                    "Chú/cô có nuôi gà, vịt gì không?",
                    "Chú/cô muốn biết về kỹ thuật trồng dưa lưới không?",
                    "Chú/cô cần thông tin giá nông sản không?"
                ],
                weather: [
                    "Dạ, hôm nay thời tiết khá thuận lợi cho việc canh tác ạ. Nhiệt độ 28°C, độ ẩm 75% - điều kiện tốt cho cây trồng phát triển.",
                    "Dự báo thời tiết cho ngày mai: Nắng nhẹ, nhiệt độ 26-30°C. Đây là thời điểm tốt để bón phân và tưới nước ạ."
                ],
                farming: [
                    "Dạ, để tăng năng suất cây trồng, chú/cô nên: 1) Tưới nước đều đặn vào sáng sớm, 2) Bón phân hữu cơ, 3) Kiểm tra sâu bệnh thường xuyên ạ.",
                    "Kỹ thuật canh tác hiện đại: Sử dụng hệ thống tưới nhỏ giọt, trồng xen canh, và áp dụng IPM (Quản lý dịch hại tổng hợp) ạ."
                ],
                pest: [
                    "Dạ, để phòng trừ sâu bệnh hiệu quả: 1) Thường xuyên kiểm tra cây trồng, 2) Sử dụng thuốc sinh học, 3) Duy trì đa dạng sinh học trong vườn ạ.",
                    "Các loại thuốc sinh học an toàn: Bacillus thuringiensis, Beauveria bassiana, và các chế phẩm từ neem ạ."
                ],
                rice: {
                    basic: "Dạ, về trồng lúa ở miền Tây, cháu sẽ hướng dẫn chú/cô chi tiết về bón phân và chăm sóc hiệu quả ạ.",
                    detailed: {
                        season: "🌾 Thời vụ trồng lúa miền Tây:\n• Vụ Đông Xuân: Tháng 11-3\n• Vụ Hè Thu: Tháng 4-8\n• Vụ Thu Đông: Tháng 8-11",
                        fertilizer: "💩 Bón phân cho lúa:\n• Bón lót: Phân chuồng + NPK 20-20-15\n• Bón thúc lần 1 (7-10 ngày): NPK 20-20-15\n• Bón thúc lần 2 (25-30 ngày): NPK 16-16-8\n• Bón đón đòng: NPK 12-12-17",
                        care: "🌱 Chăm sóc lúa:\n• Tưới nước: Giữ mực nước 3-5cm\n• Làm cỏ: 2-3 lần/vụ\n• Phòng bệnh: Đạo ôn, khô vằn\n• Thu hoạch: Khi lúa chín 85-90%"
                    }
                },
                chili: {
                    basic: "Dạ, về cây ớt bị vàng lá và rụng trái, có thể do nấm hoặc thiếu dinh dưỡng. Cháu sẽ hướng dẫn chú/cô cách xử lý ạ.",
                    detailed: {
                        disease: "🦠 Bệnh thường gặp trên ớt:\n• Bệnh thán thư: Đốm nâu, thối trái\n• Bệnh héo rũ: Do nấm Fusarium\n• Bệnh đốm lá: Do vi khuẩn\n• Bệnh virus: Lá vàng, còi cọc",
                        treatment: "💊 Cách xử lý:\n• Phun thuốc sinh học: Trichoderma, Bacillus\n• Thuốc hóa học: Mancozeb, Copper\n• Cách ly cây bị bệnh\n• Vệ sinh vườn thường xuyên",
                        nutrition: "🌿 Thiếu dinh dưỡng:\n• Thiếu N: Lá vàng nhạt\n• Thiếu P: Lá tím, rễ kém\n• Thiếu K: Lá vàng viền, rụng trái\n• Bón phân cân đối NPK"
                    }
                },
                chicken: {
                    basic: "Dạ, về gà thả vườn ăn ít và tiêu chảy, có thể do bệnh hoặc thức ăn. Cháu sẽ hướng dẫn chú/cô cách xử lý ạ.",
                    detailed: {
                        disease: "🐔 Bệnh thường gặp:\n• Bệnh Newcastle: Tiêu chảy, thở khó\n• Bệnh Gumboro: Tiêu chảy trắng\n• Bệnh cầu trùng: Tiêu chảy có máu\n• Bệnh E.coli: Tiêu chảy, bỏ ăn",
                        treatment: "💊 Cách xử lý:\n• Cách ly gà bị bệnh\n• Vệ sinh chuồng trại\n• Bổ sung vitamin, điện giải\n• Thuốc kháng sinh nếu cần",
                        prevention: "🛡️ Phòng bệnh:\n• Tiêm phòng đầy đủ\n• Vệ sinh chuồng trại\n• Thức ăn sạch, nước sạch\n• Kiểm tra sức khỏe định kỳ"
                    }
                },
                melon: {
                    basic: "Dạ, dưa lưới là cây trồng có giá trị kinh tế cao. Cháu sẽ hướng dẫn chú/cô kỹ thuật trồng dưa lưới từ A-Z để đạt năng suất tối ưu ạ.",
                    detailed: {
                        season: "🍈 Thời vụ trồng dưa lưới:\n• Miền Nam: Tháng 11-4 (mùa khô)\n• Miền Bắc: Tháng 2-4 và 8-10\n• Tránh mùa mưa để giảm bệnh\n• Nhiệt độ lý tưởng: 25-30°C",
                        soil: "🪴 Chuẩn bị đất:\n• Đất tơi xốp, cao ráo, thoát nước tốt\n• pH: 6.0-7.0\n• Trộn: Đất + phân bò hoai + tro trấu + trichoderma\n• Có thể trồng trong thùng xốp, bao xi măng",
                        seeding: "🌱 Gieo hạt:\n• Ngâm hạt nước ấm (2 sôi:3 lạnh) 6-8h\n• Ủ khăn ẩm 1 ngày\n• Gieo vào bầu ươm hoặc thẳng chậu\n• Sau 7-10 ngày cây cao 10-15cm thì trồng",
                        care: "🧑‍🌾 Chăm sóc:\n• Tưới nước mỗi sáng, tránh tối\n• Bón phân:\n  - 7 ngày: NPK 16-16-8 pha loãng\n  - 15-20 ngày: Phân hữu cơ vi sinh\n  - Khi ra hoa: Phân Kali cao",
                        pollination: "🌼 Thụ phấn:\n• Thụ phấn bằng tay (sáng sớm trước 9h)\n• Lấy nhụy đực chấm nhụy cái\n• Hoa cái có bầu nhỏ dưới đáy\n• Quan trọng cho năng suất",
                        trellis: "🕸️ Làm giàn:\n• Giàn chữ A hoặc treo dây nylon\n• Giúp trái sạch, không méo\n• Cây leo cần hỗ trợ\n• Khoảng cách giàn: 1.5-2m",
                        disease: "🐛 Phòng bệnh:\n• Nấm hại rễ, rỉ trắng, bọ trĩ\n• Thuốc sinh học: Trichoderma, Radiant, Abamectin\n• Duy trì độ ẩm vừa phải\n• Vệ sinh vườn thường xuyên",
                        harvest: "⏱ Thu hoạch:\n• Sau 65-75 ngày\n• Vỏ chuyển vàng nhạt\n• Có lưới rõ, thơm nhẹ\n• Năng suất: 2-3kg/trái"
                    },
                    tips: [
                        "Chọn giống dưa lưới chất lượng cao",
                        "Làm giàn ngay từ đầu để cây leo tốt",
                        "Thụ phấn đúng thời điểm để đậu trái nhiều",
                        "Bón phân cân đối để trái ngọt",
                        "Phòng bệnh sớm để tránh thiệt hại"
                    ]
                },
                durian: {
                    basic: "Dạ, về cây sầu riêng giai đoạn ra hoa, cháu sẽ hướng dẫn chú/cô loại phân phù hợp ạ.",
                    detailed: {
                        flowering: "🌸 Giai đoạn ra hoa:\n• Dùng phân bón lá có Bo cao\n• NPK 15-30-15 hoặc 10-30-20\n• Bón qua lá 2-3 lần\n• Tưới nước đều đặn",
                        care: "🌳 Chăm sóc sầu riêng:\n• Tỉa cành tạo tán\n• Bón phân hữu cơ gốc\n• Phòng bệnh thán thư\n• Thụ phấn nhân tạo nếu cần"
                    }
                },
                coffee: {
                    basic: "Dạ, về cây cà phê, cháu sẽ nhắc chú/cô bón phân định kỳ vào sáng thứ Bảy hàng tuần ạ.",
                    detailed: {
                        schedule: "📅 Lịch bón phân cà phê:\n• Tháng 2-3: Bón phân hữu cơ\n• Tháng 4-5: NPK 20-20-15\n• Tháng 6-7: NPK 16-16-8\n• Tháng 8-9: NPK 12-12-17",
                        reminder: "⏰ Nhắc nhở:\n• Bón phân vào sáng thứ Bảy\n• Tưới nước sau khi bón\n• Kiểm tra sâu bệnh\n• Ghi chép để theo dõi"
                    }
                },
                price: {
                    basic: "Dạ, về giá nông sản, cháu sẽ cập nhật thông tin mới nhất cho chú/cô ạ.",
                    detailed: {
                        rice: "🌾 Giá lúa IR50404 Long An:\n• Hôm nay: 7,200-7,500 đ/kg\n• Tuần trước: 7,000-7,300 đ/kg\n• Xu hướng: Tăng nhẹ\n• Khuyến nghị: Bán từng phần",
                        fruit: "🍎 Giá trái cây:\n• Xoài: 15,000-25,000 đ/kg\n• Sầu riêng: 80,000-120,000 đ/kg\n• Dưa lưới: 25,000-35,000 đ/kg\n• Cà phê: 45,000-55,000 đ/kg"
                    }
                },
                weed: {
                    basic: "Dạ, về kỹ thuật diệt cỏ hiệu quả, cháu sẽ hướng dẫn chú/cô các phương pháp an toàn và hiệu quả ạ.",
                    detailed: {
                        manual: "👨‍🌾 Diệt cỏ thủ công:\n• Nhổ cỏ bằng tay: Hiệu quả, an toàn\n• Cắt cỏ bằng liềm: Nhanh, tiết kiệm\n• Làm cỏ định kỳ: 2-3 lần/vụ\n• Thời điểm: Sáng sớm hoặc chiều mát",
                        chemical: "🧪 Thuốc diệt cỏ:\n• Glyphosate: Diệt cỏ toàn diện\n• 2,4-D: Diệt cỏ lá rộng\n• Paraquat: Diệt cỏ tiếp xúc\n• Lưu ý: Đọc kỹ hướng dẫn, bảo hộ đầy đủ",
                        organic: "🌱 Diệt cỏ hữu cơ:\n• Muối: Rải muối vào gốc cỏ\n• Giấm: Phun giấm trắng 5%\n• Nước sôi: Đổ nước sôi vào gốc\n• Che phủ: Dùng bạt, rơm rạ",
                        prevention: "🛡️ Phòng ngừa cỏ:\n• Trồng dày: Giảm ánh sáng đến đất\n• Che phủ: Rơm rạ, bạt nilon\n• Luân canh: Thay đổi cây trồng\n• Vệ sinh: Dọn sạch cỏ quanh vườn"
                    }
                }
            },
            business: {
                title: "Trợ lý Doanh nhân",
                greeting: [
                    "Chào bạn! Tôi là V-AI, trợ lý thông minh cho doanh nhân. Tôi có thể giúp bạn với chiến lược kinh doanh, marketing, và quản lý. Bạn cần tôi hỗ trợ gì hôm nay?",
                    "Xin chào! Tôi sẵn sàng hỗ trợ bạn trong công việc kinh doanh. Bạn có thể hỏi tôi về marketing, tài chính, hoặc quản lý doanh nghiệp."
                ],
                askDetail: "Để tôi có thể hỗ trợ tốt hơn, bạn có thể cho tôi biết:\n• Bạn kinh doanh lĩnh vực gì?\n• Quy mô doanh nghiệp của bạn?\n• Mục tiêu kinh doanh hiện tại?",
                followUpQuestions: [
                    "Bạn kinh doanh lĩnh vực gì?",
                    "Quy mô doanh nghiệp của bạn?",
                    "Bạn gặp khó khăn gì trong marketing?",
                    "Bạn muốn mở rộng thị trường như thế nào?",
                    "Doanh thu hiện tại của bạn ra sao?"
                ],
                strategy: [
                    "Để phát triển doanh nghiệp hiệu quả: 1) Phân tích thị trường mục tiêu, 2) Xây dựng chiến lược marketing, 3) Tối ưu hóa quy trình vận hành.",
                    "Chiến lược kinh doanh hiện đại: Sử dụng digital marketing, phân tích dữ liệu khách hàng, và áp dụng công nghệ 4.0."
                ],
                marketing: [
                    "Các kênh marketing hiệu quả: 1) Social media marketing, 2) Content marketing, 3) Email marketing, 4) SEO/SEM.",
                    "Để tăng doanh số: Tập trung vào trải nghiệm khách hàng, xây dựng thương hiệu mạnh, và sử dụng data analytics."
                ],
                finance: {
                    basic: "Quản lý tài chính doanh nghiệp là yếu tố quan trọng để phát triển bền vững.",
                    detailed: {
                        planning: "📊 Lập kế hoạch tài chính:\n• Dự báo doanh thu theo tháng/quý/năm\n• Phân bổ ngân sách cho các hoạt động\n• Thiết lập quỹ dự phòng 10-15%\n• Theo dõi dòng tiền hàng ngày",
                        cost: "💰 Kiểm soát chi phí:\n• Phân loại chi phí cố định và biến động\n• Tối ưu hóa chi phí vận hành\n• Đàm phán với nhà cung cấp\n• Sử dụng công nghệ để tiết kiệm",
                        investment: "💹 Đầu tư thông minh:\n• Đa dạng hóa danh mục đầu tư\n• Đánh giá ROI trước khi đầu tư\n• Tái đầu tư lợi nhuận hợp lý\n• Xây dựng quỹ phát triển"
                    }
                },
                digital: {
                    basic: "Digital marketing là chìa khóa thành công trong thời đại số.",
                    detailed: {
                        social: "📱 Social Media Marketing:\n• Facebook/Instagram: Tương tác cao, quảng cáo hiệu quả\n• TikTok: Xu hướng trẻ, viral nhanh\n• LinkedIn: B2B, networking chuyên nghiệp\n• YouTube: Content dài, SEO tốt",
                        content: "📝 Content Marketing:\n• Blog: SEO, xây dựng authority\n• Video: Tương tác cao, dễ nhớ\n• Infographic: Dễ chia sẻ, thông tin rõ ràng\n• Podcast: Tiếp cận khách hàng mục tiêu",
                        seo: "🔍 SEO & SEM:\n• Từ khóa: Nghiên cứu, tối ưu hóa\n• On-page: Meta tags, content quality\n• Off-page: Backlinks, social signals\n• Local SEO: Google My Business"
                    }
                },
                management: {
                    basic: "Quản lý doanh nghiệp hiệu quả cần hệ thống và quy trình rõ ràng.",
                    detailed: {
                        team: "👥 Quản lý nhân sự:\n• Tuyển dụng: Job description rõ ràng\n• Đào tạo: Kế hoạch phát triển kỹ năng\n• Đánh giá: KPI, feedback định kỳ\n• Giữ chân: Lương thưởng, môi trường làm việc",
                        process: "⚙️ Tối ưu quy trình:\n• Mapping: Vẽ sơ đồ quy trình hiện tại\n• Phân tích: Tìm điểm nghẽn, lãng phí\n• Cải tiến: Áp dụng Lean, Six Sigma\n• Tự động hóa: Sử dụng công nghệ",
                        quality: "✅ Quản lý chất lượng:\n• Tiêu chuẩn: ISO, industry standards\n• Kiểm soát: QC/QA procedures\n• Cải tiến: PDCA cycle\n• Khách hàng: Feedback, satisfaction"
                    }
                }
            },
            teacher: {
                title: "Trợ lý Giáo viên",
                greeting: [
                    "Chào bạn! Tôi là V AI, trợ lý thông minh cho giáo viên. Tôi có thể giúp bạn soạn giáo án, quản lý lớp học, và phương pháp giảng dạy. Bạn cần tôi hỗ trợ gì hôm nay?",
                    "Xin chào! Tôi sẵn sàng hỗ trợ bạn trong công việc giảng dạy. Bạn có thể hỏi tôi về phương pháp sư phạm, công nghệ giáo dục."
                ],
                askDetail: "Để tôi có thể hỗ trợ tốt hơn, bạn có thể cho tôi biết:\n• Bạn dạy môn học gì?\n• Cấp học bạn đang dạy?\n• Khó khăn trong giảng dạy?",
                followUpQuestions: [
                    "Bạn dạy môn học gì?",
                    "Bạn dạy cấp học nào?",
                    "Bạn gặp khó khăn gì trong giảng dạy?",
                    "Bạn muốn cải thiện phương pháp dạy như thế nào?",
                    "Sĩ số lớp học của bạn là bao nhiêu?"
                ],
                lesson: [
                    "Để soạn giáo án hiệu quả: 1) Xác định mục tiêu học tập rõ ràng, 2) Thiết kế hoạt động đa dạng, 3) Đánh giá kết quả học tập.",
                    "Phương pháp giảng dạy hiện đại: Sử dụng công nghệ, học tập dựa trên dự án, và học tập hợp tác."
                ],
                management: [
                    "Quản lý lớp học hiệu quả: 1) Thiết lập quy tắc rõ ràng, 2) Tạo môi trường học tập tích cực, 3) Giao tiếp hiệu quả với phụ huynh.",
                    "Công nghệ giáo dục: Sử dụng LMS, công cụ đánh giá trực tuyến, và phương pháp blended learning."
                ],
                methodology: {
                    basic: "Phương pháp giảng dạy hiện đại giúp tăng hiệu quả học tập.",
                    detailed: {
                        active: "🎯 Học tập chủ động:\n• Project-based learning: Học qua dự án thực tế\n• Problem-based learning: Giải quyết vấn đề\n• Inquiry-based learning: Học qua khám phá\n• Cooperative learning: Học tập hợp tác",
                        tech: "💻 Công nghệ trong giảng dạy:\n• LMS: Moodle, Google Classroom\n• Interactive tools: Kahoot, Mentimeter\n• Virtual reality: Mô phỏng 3D\n• AI tools: ChatGPT, Grammarly",
                        assessment: "📊 Đánh giá đa dạng:\n• Formative: Đánh giá quá trình\n• Summative: Đánh giá cuối kỳ\n• Peer assessment: Đánh giá đồng đẳng\n• Self-assessment: Tự đánh giá"
                    }
                },
                classroom: {
                    basic: "Quản lý lớp học hiệu quả tạo môi trường học tập tốt.",
                    detailed: {
                        rules: "📋 Thiết lập quy tắc:\n• Quy tắc rõ ràng, dễ hiểu\n• Thống nhất với học sinh\n• Khen thưởng tích cực\n• Xử lý vi phạm công bằng",
                        environment: "🌱 Môi trường học tập:\n• Bố trí lớp học linh hoạt\n• Tạo không gian sáng tạo\n• Sử dụng màu sắc tích cực\n• Ánh sáng và âm thanh phù hợp",
                        communication: "💬 Giao tiếp hiệu quả:\n• Lắng nghe tích cực\n• Phản hồi kịp thời\n• Giao tiếp với phụ huynh\n• Xây dựng mối quan hệ tin cậy"
                    }
                },
                curriculum: {
                    basic: "Thiết kế chương trình giảng dạy phù hợp với mục tiêu.",
                    detailed: {
                        planning: "📝 Lập kế hoạch giảng dạy:\n• Phân tích mục tiêu học tập\n• Thiết kế hoạt động đa dạng\n• Phân bổ thời gian hợp lý\n• Chuẩn bị tài liệu hỗ trợ",
                        differentiation: "🎨 Phân hóa giảng dạy:\n• Đánh giá năng lực học sinh\n• Thiết kế nhiệm vụ đa dạng\n• Hỗ trợ cá nhân hóa\n• Đánh giá theo tiến độ",
                        integration: "🔗 Tích hợp liên môn:\n• Kết nối kiến thức các môn\n• Dự án liên môn\n• Ứng dụng thực tế\n• Phát triển kỹ năng tổng hợp"
                    }
                }
            },
            developer: {
                title: "Trợ lý Lập trình viên",
                greeting: [
                    "Chào bạn! Tôi là V AI, trợ lý thông minh cho lập trình viên. Tôi có thể giúp bạn với coding, debug, và kiến trúc phần mềm. Bạn cần tôi hỗ trợ gì hôm nay?",
                    "Xin chào! Tôi sẵn sàng hỗ trợ bạn trong công việc lập trình. Bạn có thể hỏi tôi về code, framework, hoặc best practices."
                ],
                askDetail: "Để tôi có thể hỗ trợ tốt hơn, bạn có thể cho tôi biết:\n• Ngôn ngữ lập trình bạn chuyên?\n• Frontend hay Backend?\n• Dự án hiện tại bạn đang làm?",
                followUpQuestions: [
                    "Bạn chuyên về ngôn ngữ lập trình nào?",
                    "Bạn làm frontend hay backend?",
                    "Bạn gặp khó khăn gì trong coding?",
                    "Bạn muốn học framework mới nào?",
                    "Dự án hiện tại bạn đang làm là gì?"
                ],
                coding: [
                    "Best practices trong lập trình: 1) Clean code, 2) Code review, 3) Unit testing, 4) Documentation.",
                    "Các framework phổ biến: React, Vue.js, Angular cho frontend; Node.js, Django, Spring cho backend."
                ],
                debug: [
                    "Kỹ thuật debug hiệu quả: 1) Sử dụng debugger, 2) Logging, 3) Error handling, 4) Performance monitoring.",
                    "Công cụ debug: Chrome DevTools, VS Code debugger, Postman, và các IDE tích hợp."
                ],
                frontend: {
                    basic: "Frontend development tập trung vào trải nghiệm người dùng.",
                    detailed: {
                        frameworks: "⚛️ Framework phổ biến:\n• React: Component-based, ecosystem lớn\n• Vue.js: Dễ học, progressive framework\n• Angular: Enterprise, TypeScript native\n• Svelte: Compile-time framework, performance cao",
                        tools: "🛠️ Công cụ phát triển:\n• Build tools: Webpack, Vite, Parcel\n• Package managers: npm, yarn, pnpm\n• CSS frameworks: Tailwind, Bootstrap, Material-UI\n• Testing: Jest, Cypress, Playwright",
                        optimization: "🚀 Tối ưu hóa:\n• Code splitting: Lazy loading components\n• Image optimization: WebP, lazy loading\n• Caching: Service workers, CDN\n• Performance: Lighthouse, Core Web Vitals"
                    }
                },
                backend: {
                    basic: "Backend development xử lý logic nghiệp vụ và dữ liệu.",
                    detailed: {
                        languages: "🐍 Ngôn ngữ phổ biến:\n• Python: Django, Flask, FastAPI\n• Node.js: Express, NestJS, Koa\n• Java: Spring Boot, Jakarta EE\n• C#: ASP.NET Core, Entity Framework",
                        databases: "🗄️ Cơ sở dữ liệu:\n• SQL: PostgreSQL, MySQL, SQL Server\n• NoSQL: MongoDB, Redis, Cassandra\n• ORM: Prisma, Sequelize, Entity Framework\n• Migration: Version control cho database",
                        architecture: "🏗️ Kiến trúc hệ thống:\n• Microservices: Chia nhỏ ứng dụng\n• REST API: Stateless, resource-based\n• GraphQL: Flexible data fetching\n• Event-driven: Message queues, pub/sub"
                    }
                },
                devops: {
                    basic: "DevOps kết hợp development và operations.",
                    detailed: {
                        ci_cd: "🔄 CI/CD Pipeline:\n• Version control: Git, GitHub Actions\n• Build automation: Jenkins, GitLab CI\n• Deployment: Docker, Kubernetes\n• Monitoring: Prometheus, Grafana",
                        cloud: "☁️ Cloud platforms:\n• AWS: EC2, S3, Lambda, RDS\n• Azure: App Service, Functions, Cosmos DB\n• GCP: Compute Engine, Cloud Storage, Firebase\n• Serverless: FaaS, BaaS",
                        security: "🔒 Bảo mật:\n• Authentication: JWT, OAuth, OIDC\n• Authorization: RBAC, ABAC\n• Encryption: HTTPS, TLS, data encryption\n• Security scanning: SAST, DAST, dependency check"
                    }
                }
            },
            sales: {
                title: "Nhân viên bán hàng",
                greeting: [
                    "Chào bạn! Tôi là V-AI, trợ lý thông minh cho nhân viên bán hàng. Tôi có thể giúp bạn với kỹ năng bán hàng, chăm sóc khách hàng, và quản lý đơn hàng. Bạn cần tôi hỗ trợ gì hôm nay?",
                    "Xin chào! Tôi sẵn sàng hỗ trợ bạn trong công việc bán hàng. Bạn có thể hỏi tôi về kỹ năng bán hàng, cách chăm sóc khách hàng, hoặc quản lý đơn hàng."
                ],
                askDetail: "Để tôi có thể hỗ trợ tốt hơn, bạn có thể cho tôi biết:\n• Bạn đã có kinh nghiệm bán hàng chưa?\n• Bạn thường bán hàng ở đâu?\n• Bạn có thể chăm sóc khách hàng như thế nào?",
                followUpQuestions: [
                    "Bạn đã có kinh nghiệm bán hàng chưa?",
                    "Bạn thường bán hàng ở đâu?",
                    "Bạn có thể chăm sóc khách hàng như thế nào?",
                    "Bạn muốn tăng doanh số bán hàng như thế nào?",
                    "Bạn có thể quản lý đơn hàng như thế nào?"
                ],
                skillsales:[
                'Cách tìm kiếm và tiếp cận khách hàng tiềm năng',
                'Bí quyết chốt đơn hiệu quả',
                'Chăm sóc khách hàng sau bán',
                'Quản lý đơn hàng và tồn kho thông minh'

                ]
                
            },
            office: {
                title: "Trợ lý Văn phòng",
                greeting: [
                    "Chào bạn! Tôi là V-AI, trợ lý văn phòng ảo của bạn. Tôi có thể hỗ trợ bạn với các công việc hành chính, quản lý thời gian và sử dụng công cụ văn phòng. Bạn cần giúp gì hôm nay?",
                    "Xin chào! Tôi ở đây để giúp công việc văn phòng của bạn trở nên dễ dàng hơn. Hãy hỏi tôi về cách viết email, tổ chức cuộc họp, hoặc mẹo dùng Excel nhé!"
                ],
                followUpQuestions: [
                    "Làm sao để viết email chuyên nghiệp?",
                    "Cách tổ chức một cuộc họp hiệu quả?",
                    "Mẹo quản lý thời gian tốt nhất?",
                    "Chỉ tôi vài hàm Excel thông dụng.",
                    "Làm thế nào để cải thiện kỹ năng giao tiếp?",
                    "Cách lập kế hoạch cho một dự án?",
                    "Làm sao để giải quyết xung đột nơi công sở?"
                ],
                email: {
                    basic: "Viết email chuyên nghiệp là một kỹ năng quan trọng. Tôi sẽ hướng dẫn bạn các bước cơ bản.",
                    detailed: {
                        subject: "📧 Tiêu đề email:\n• Rõ ràng, ngắn gọn, súc tích.\n• Ví dụ: 'Báo cáo cuộc họp ngày 25/07' thay vì 'Gửi báo cáo'.\n• Thêm tiền tố nếu cần: [ACTION], [INFO], [URGENT].",
                        greeting: "👋 Chào hỏi:\n• Trang trọng: 'Kính gửi Anh/Chị [Tên]', 'Dear Mr./Ms. [Last Name]'.\n• Thân mật: 'Chào [Tên]', 'Hi [Name]'.\n• Luôn dùng tên riêng nếu biết.",
                        body: "✍️ Nội dung chính:\n• Vào thẳng vấn đề, trình bày mạch lạc.\n• Sử dụng đoạn văn ngắn, gạch đầu dòng.\n• Bôi đậm ý chính nếu cần.\n• Kiểm tra lỗi chính tả, ngữ pháp trước khi gửi.",
                        closing: "🙏 Kết thúc và chữ ký:\n• Kết thúc: 'Trân trọng,', 'Best regards,', 'Xin cảm ơn,'.\n• Chữ ký: Ghi rõ Họ tên, Chức vụ, Công ty, Thông tin liên hệ."
                    }
                },
                meeting: {
                    basic: "Tổ chức cuộc họp hiệu quả giúp tiết kiệm thời gian và đạt được mục tiêu. Tôi có một vài gợi ý cho bạn.",
                    detailed: {
                        before: "事前 (Trước cuộc họp):\n• Xác định mục tiêu rõ ràng.\n• Lên danh sách người tham dự cần thiết.\n• Gửi agenda (chương trình họp) trước 1-2 ngày.\n• Chuẩn bị tài liệu liên quan.",
                        during: "実施 (Trong cuộc họp):\n• Bắt đầu và kết thúc đúng giờ.\n• Bám sát agenda đã gửi.\n• Khuyến khích mọi người tham gia.\n• Ghi lại biên bản họp (meeting minutes).",
                        after: "事後 (Sau cuộc họp):\n• Gửi biên bản họp cho tất cả người tham dự trong vòng 24h.\n• Tóm tắt các quyết định chính và các mục cần hành động (action items).\n• Theo dõi tiến độ của các action items."
                    }
                },
                timeManagement: {
                    basic: "Quản lý thời gian hiệu quả giúp bạn giảm stress và tăng năng suất. Hãy cùng xem qua vài phương pháp nhé.",
                    detailed: {
                        matrix: "📊 Ma trận Eisenhower:\n• Quan trọng & Khẩn cấp: Làm ngay.\n• Quan trọng & Không khẩn cấp: Lên kế hoạch.\n• Không quan trọng & Khẩn cấp: Ủy thác.\n• Không quan trọng & Không khẩn cấp: Loại bỏ.",
                        pomodoro: "🍅 Kỹ thuật Pomodoro:\n• Làm việc tập trung trong 25 phút.\n• Nghỉ giải lao ngắn 5 phút.\n• Sau 4 phiên Pomodoro, nghỉ dài 15-30 phút.\n• Giúp duy trì sự tập trung cao độ.",
                        planning: "🗓️ Lên kế hoạch:\n• Sử dụng to-do list hàng ngày.\n• Đặt ra 3 mục tiêu quan trọng nhất trong ngày (MITs).\n• Phân bổ thời gian cho từng công việc (time blocking).\n• Dành thời gian cuối ngày để tổng kết và lên kế hoạch cho ngày mai."
                    }
                },
                excel: {
                    basic: "Excel là một công cụ cực kỳ mạnh mẽ. Tôi sẽ chỉ bạn một số hàm và mẹo hay dùng nhất.",
                    detailed: {
                        functions: "🔢 Các hàm thông dụng:\n• SUM, AVERAGE, COUNT: Cơ bản tính toán.\n• VLOOKUP/HLOOKUP: Tìm kiếm dữ liệu từ bảng khác.\n• IF: Thực hiện hành động dựa trên điều kiện.\n• CONCATENATE: Nối các chuỗi văn bản.\n• PIVOTTABLE: Tổng hợp và phân tích dữ liệu lớn.",
                        shortcuts: "⌨️ Phím tắt hữu ích:\n• Ctrl + Arrow Keys: Di chuyển đến cuối vùng dữ liệu.\n• Ctrl + Shift + L: Bật/tắt bộ lọc.\n• Ctrl + T: Tạo bảng (Table).\n• Alt + =: Tự động tính tổng (AutoSum).",
                        tips: "💡 Mẹo hay:\n• Conditional Formatting: Tô màu ô theo điều kiện để dễ nhìn.\n• Data Validation: Giới hạn dữ liệu nhập vào ô để tránh sai sót.\n• Freeze Panes: Cố định dòng/cột tiêu đề khi cuộn."
                    }
                }
            },
            other: {
                title: "Trợ lý AI",
                greeting: [
                    "Chào bạn! Tôi là V AI, trợ lý AI thông minh. Tôi có thể giúp bạn với nhiều lĩnh vực khác nhau. Bạn cần tôi hỗ trợ gì hôm nay?",
                    "Xin chào! Tôi sẵn sàng hỗ trợ bạn trong công việc. Bạn có thể hỏi tôi về bất kỳ vấn đề nào."
                ],
                askDetail: "Để tôi có thể hỗ trợ tốt hơn, bạn có thể cho tôi biết:\n• Lĩnh vực bạn làm việc?\n• Công việc hiện tại?\n• Mục tiêu nghề nghiệp?",
                followUpQuestions: [
                    "Bạn làm việc trong lĩnh vực gì?",
                    "Công việc hiện tại của bạn như thế nào?",
                    "Bạn gặp khó khăn gì trong công việc?",
                    "Bạn muốn phát triển kỹ năng gì?",
                    "Mục tiêu nghề nghiệp của bạn là gì?"
                ],
                general: [
                    "Tôi có thể hỗ trợ bạn với: 1) Tìm kiếm thông tin, 2) Phân tích dữ liệu, 3) Tư vấn chung, 4) Hỗ trợ công việc.",
                    "Hãy cho tôi biết bạn làm việc trong lĩnh vực nào để tôi có thể hỗ trợ tốt hơn."
                ]
            }
        };

        function selectCareer(career) {
            console.log('selectCareer called with:', career); // Debug log
            
            currentCareer = career;
            console.log('currentCareer set to:', currentCareer); // Debug log
            
            document.getElementById('careerSelection').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            // Update career title
            const careerTitle = document.getElementById('careerTitle');
            careerTitle.textContent = careerResponses[career].title;
            
            console.log('Career selection UI updated'); // Debug log
            
            // Send welcome message and ask for name
            setTimeout(() => {
                const welcomeMsg = careerResponses[career].greeting[Math.floor(Math.random() * careerResponses[career].greeting.length)];
                console.log('Adding welcome message:', welcomeMsg); // Debug log
                addMessage(welcomeMsg, false);
                setTimeout(() => {
                    // Check if name already exists
                    if (!userProfile.name) {
                        console.log('No name found, asking for name'); // Debug log
                        askForName();
                    } else {
                        console.log('Name found:', userProfile.name); // Debug log
                        const userInfo = document.getElementById('userInfo');
                        if(userInfo) {
                           userInfo.textContent = `Chào mừng ${userProfile.name}!`;
                        }
                        const welcomeBackMsg = `Chào mừng ${userProfile.name} quay trở lại!`;
                        addMessage(welcomeBackMsg, false);
                        setTimeout(() => {
                            console.log('Showing suggestion buttons'); // Debug log
                            showSuggestionButtons();
                        }, 500);
                    }
                }, 1000);
            }, 500);
        }

        function askForName() {
            const messagesContainer = document.getElementById('messages');
            
            const questionDiv = document.createElement('div');
            questionDiv.className = 'flex justify-start';
            const questionBubble = document.createElement('div');
            questionBubble.className = 'message-bubble px-4 py-3 rounded-2xl shadow-sm bg-blue-50 border border-blue-200';
            questionBubble.innerHTML = `<p class="text-sm text-gray-700 font-medium">Để tiện xưng hô, bạn cho tôi biết tên của bạn nhé? 😊</p>`;
            questionDiv.appendChild(questionBubble);
            messagesContainer.appendChild(questionDiv);

            const formDiv = document.createElement('div');
            formDiv.className = 'flex justify-start w-full';
            formDiv.id = 'name-form-container';
            
            const formBubble = document.createElement('div');
            formBubble.className = 'message-bubble w-full px-4 py-3 rounded-2xl shadow-sm bg-green-50 border border-green-200';
            
            const form = document.createElement('form');
            form.className = 'w-full flex items-center gap-2';
            form.onsubmit = (e) => {
                e.preventDefault();
                const nameInput = form.querySelector('input');
                const name = nameInput.value.trim();
                if (name) {
                    submitName(name);
                }
            };
            
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'w-full flex-grow p-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500';
            input.placeholder = 'Nhập tên của bạn...';
            input.required = true;
            
            const submitButton = document.createElement('button');
            submitButton.type = 'submit';
            submitButton.className = 'px-4 py-2 bg-blue-500 text-white rounded-lg text-sm font-semibold hover:bg-blue-600';
            submitButton.textContent = 'Gửi';
            
            form.appendChild(input);
            form.appendChild(submitButton);
            formBubble.appendChild(form);
            formDiv.appendChild(formBubble);
            messagesContainer.appendChild(formDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            setTimeout(() => input.focus(), 100);
        }

        function submitName(name) {
            const formContainer = document.getElementById('name-form-container');
            if(formContainer) formContainer.remove();

            addMessage(name, true);

            userProfile.name = name;
            localStorage.setItem('userProfile', JSON.stringify(userProfile));
            
            const userInfo = document.getElementById('userInfo');
            if(userInfo) {
                userInfo.textContent = `Chào mừng ${name}!`;
            }

            setTimeout(() => {
                const confirmationMsg = `Rất vui được làm quen, ${name}! 😊`;
                addMessage(confirmationMsg, false);
                setTimeout(() => {
                    showSuggestionButtons();
                }, 1000);
            }, 500);
        }

        function askPersonalInfo(career) {
            const personalQuestions = getPersonalQuestions(career);
            const messagesContainer = document.getElementById('messages');
            const questionDiv = document.createElement('div');
            questionDiv.className = 'flex justify-start';
            
            const questionBubble = document.createElement('div');
            questionBubble.className = 'message-bubble px-4 py-3 rounded-2xl shadow-sm bg-blue-50 border border-blue-200';
            
            const questionText = document.createElement('p');
            questionText.className = 'text-sm text-gray-700 mb-3 font-medium';
            questionText.textContent = `Để cháu có thể tư vấn tốt hơn, ${userProfile.name || 'chú/cô'} hãy cho cháu biết một chút về công việc nhé:`;
            
            const listDiv = document.createElement('div');
            listDiv.className = 'space-y-2 mb-3';
            
            personalQuestions.forEach((question, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'flex items-start text-sm text-gray-600';
                itemDiv.innerHTML = `
                    <span class="mr-2 mt-1">${index + 1}.</span>
                    <span>${question}</span>
                `;
                listDiv.appendChild(itemDiv);
            });
            
            const instructionText = document.createElement('p');
            instructionText.className = 'text-sm text-gray-700 font-medium';
            instructionText.textContent = 'Chú/cô có thể trả lời từng câu hỏi hoặc mô tả tổng quan về tình hình của mình:';
            
            questionBubble.appendChild(questionText);
            questionBubble.appendChild(listDiv);
            questionBubble.appendChild(instructionText);
            questionDiv.appendChild(questionBubble);
            messagesContainer.appendChild(questionDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Hiển thị form nhập thông tin
            setTimeout(() => {
                addPersonalInfoForm();
            }, 500);
        }

        function getPersonalQuestions(career) {
            const questions = {
                farmer: [
                    'Chú/cô trồng loại cây gì chính?',
                    'Diện tích canh tác của chú/cô khoảng bao nhiêu?',
                    'Chú/cô đã làm nông nghiệp được bao lâu?',
                    'Vùng miền chú/cô đang canh tác ở đâu?',
                    'Chú/cô có sử dụng công nghệ hiện đại không?'
                ],
                business: [
                    'Bạn kinh doanh lĩnh vực gì?',
                    'Quy mô doanh nghiệp của bạn như thế nào?',
                    'Bạn đã kinh doanh được bao lâu?',
                    'Thị trường mục tiêu của bạn là gì?',
                    'Bạn có bao nhiêu nhân viên?'
                ],
                teacher: [
                    'Bạn dạy môn học gì?',
                    'Bạn dạy cấp học nào?',
                    'Bạn đã giảng dạy được bao lâu?',
                    'Sĩ số lớp học trung bình là bao nhiêu?',
                    'Bạn có sử dụng công nghệ trong giảng dạy không?'
                ],
                developer: [
                    'Bạn chuyên về ngôn ngữ lập trình nào?',
                    'Bạn làm frontend, backend hay fullstack?',
                    'Bạn đã lập trình được bao lâu?',
                    'Bạn đang làm việc ở công ty hay freelancer?',
                    'Dự án hiện tại bạn đang làm là gì?'
                ],
                sales: [
                    'Bạn đã có kinh nghiệm bán hàng chưa?',
                    'Bạn thường bán hàng ở đâu?',
                    'Bạn có thể chăm sóc khách hàng như thế nào?',
                    'Bạn muốn tăng doanh số bán hàng như thế nào?',
                    'Bạn có thể quản lý đơn hàng như thế nào?'
                ],
                office: [
                    'Bạn đã có kinh nghiệm quản lý tài liệu chưa?',
                    'Bạn thường làm việc ở đâu?',
                    'Bạn có thể quản lý công việc như thế nào?',
                    'Bạn muốn tăng hiệu suất làm việc như thế nào?',
                    'Bạn có thể giao tiếp nội bộ như thế nào?'
                ],
                other: [
                    'Bạn làm việc trong lĩnh vực gì?',
                    'Công việc hiện tại của bạn như thế nào?',
                    'Bạn đã làm việc được bao lâu?',
                    'Môi trường làm việc của bạn ra sao?',
                    'Bạn có mục tiêu nghề nghiệp gì?'
                ]
            };
            
            return questions[career] || questions.other;
        }

        function addPersonalInfoForm() {
            const messagesContainer = document.getElementById('messages');
            const formDiv = document.createElement('div');
            formDiv.className = 'flex justify-start';
            
            const formBubble = document.createElement('div');
            formBubble.className = 'message-bubble px-4 py-3 rounded-2xl shadow-sm bg-green-50 border border-green-200';
            
            const formTitle = document.createElement('p');
            formTitle.className = 'text-sm text-gray-700 mb-3 font-medium';
            formTitle.textContent = 'Hãy chia sẻ thông tin về chú/cô:';
            
            const form = document.createElement('form');
            form.className = 'space-y-3';
            form.onsubmit = (e) => {
                e.preventDefault();
                const personalInfo = form.querySelector('textarea').value;
                if (personalInfo.trim()) {
                    // Xóa form
                    formDiv.remove();
                    
                    // Thêm tin nhắn của user
                    addMessage(personalInfo, true);
                    
                    // Lưu thông tin cá nhân
                    userProfile.personalInfo = personalInfo;
                    localStorage.setItem('userProfile', JSON.stringify(userProfile));
                    
                    // AI phản hồi và gợi ý vấn đề
                    setTimeout(() => {
                        const response = getPersonalInfoResponse(personalInfo);
                        addMessage(response, false);
                        setTimeout(() => {
                            addSuggestionMessage();
                        }, 1000);
                    }, 500);
                }
            };
            
            const textarea = document.createElement('textarea');
            textarea.className = 'w-full p-3 border border-gray-300 rounded-lg text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent';
            textarea.placeholder = 'Mô tả thông tin về chú/cô và tình hình hiện tại...';
            textarea.rows = 4;
            textarea.required = true;
            
            const submitButton = document.createElement('button');
            submitButton.type = 'submit';
            submitButton.className = 'px-4 py-2 bg-blue-500 text-white rounded-lg text-sm hover:bg-blue-600 transition-colors';
            submitButton.textContent = 'Gửi thông tin';
            
            form.appendChild(textarea);
            form.appendChild(submitButton);
            formBubble.appendChild(formTitle);
            formBubble.appendChild(form);
            formDiv.appendChild(formBubble);
            messagesContainer.appendChild(formDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Focus vào textarea
            setTimeout(() => {
                textarea.focus();
            }, 100);
        }

        function getPersonalInfoResponse(personalInfo) {
            const career = careerResponses[currentCareer];
            if (!career) return 'Dạ, cảm ơn chú/cô đã chia sẻ thông tin ạ!';
            
            let response = `Dạ, cảm ơn ${userProfile.name || 'chú/cô'} đã chia sẻ! Cháu đã hiểu rõ hơn về tình hình của chú/cô ạ. `;
            
            // Thêm phản hồi dựa trên nghề nghiệp
            switch(currentCareer) {
                case 'farmer':
                    response += `Dạ, với kinh nghiệm nông nghiệp của chú/cô, cháu có thể đưa ra những tư vấn phù hợp hơn ạ. `;
                    break;
                case 'business':
                    response += `Với tình hình kinh doanh của bạn, tôi sẽ đưa ra chiến lược phù hợp. `;
                    break;
                case 'teacher':
                    response += `Với môi trường giảng dạy của bạn, tôi sẽ gợi ý phương pháp phù hợp. `;
                    break;
                case 'developer':
                    response += `Với stack công nghệ và dự án của bạn, tôi sẽ đưa ra giải pháp tối ưu. `;
                    break;
                case 'doctor':
                    response += `Với chuyên môn và môi trường làm việc của bạn, tôi sẽ đưa ra tư vấn phù hợp. `;
                    break;
                case 'lawyer':
                    response += `Với lĩnh vực pháp lý và kinh nghiệm của bạn, tôi sẽ đưa ra tư vấn chuyên môn. `;
                    break;
                default:
                    response += `Với tình hình công việc của bạn, tôi sẽ đưa ra tư vấn phù hợp. `;
            }
            
            response += `Bây giờ hãy cho tôi biết bạn đang gặp vấn đề gì nhé!`;
            
            return response;
        }

        function addSuggestionMessage() {
            const career = careerResponses[currentCareer];
            if (!career) return;
            
            const suggestions = getSuggestions(career);
            const messagesContainer = document.getElementById('messages');
            const suggestionDiv = document.createElement('div');
            suggestionDiv.className = 'flex justify-start';
            
            const suggestionBubble = document.createElement('div');
            suggestionBubble.className = 'message-bubble px-4 py-3 rounded-2xl shadow-sm bg-yellow-50 border border-yellow-200';
            
            const suggestionText = document.createElement('p');
            suggestionText.className = 'text-sm text-gray-700 mb-3 font-medium';
            suggestionText.textContent = 'Vài gợi ý về vấn đề của bạn:';
            
            const listDiv = document.createElement('div');
            listDiv.className = 'space-y-2';
            
            suggestions.forEach((suggestion, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'flex items-center text-sm text-gray-600';
                itemDiv.innerHTML = `
                    <span class="mr-2">•</span>
                    <span>${suggestion}</span>
                `;
                listDiv.appendChild(itemDiv);
            });
            
            const questionText = document.createElement('p');
            questionText.className = 'text-sm text-gray-700 mt-3 font-medium';
            questionText.textContent = 'Bạn đang gặp vấn đề gì? Hãy chọn hoặc tự mô tả:';
            
            suggestionBubble.appendChild(suggestionText);
            suggestionBubble.appendChild(listDiv);
            suggestionBubble.appendChild(questionText);
            suggestionDiv.appendChild(suggestionBubble);
            messagesContainer.appendChild(suggestionDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Hiển thị các vấn đề có thể chọn
            setTimeout(() => {
                addFollowUpQuestions();
            }, 500);
        }

        function getSuggestions(career) {
            const suggestions = {
                farmer: [
                    '🌾 Trồng lúa miền Tây',
                    '🌶️ Bệnh cây ớt vàng lá',
                    '🐔 Gà thả vườn bị bệnh',
                    '🍈 Kỹ thuật trồng dưa lưới',
                    '🌸 Sầu riêng ra hoa bón phân',
                    '☕ Nhắc bón phân cà phê',
                    '💰 Cập nhật giá nông sản',
                    '🌤️ Dự báo thời tiết nông vụ',
                    '🌿 Kỹ thuật diệt cỏ hiệu quả'
                ],
                business: [
                    '💰 Quản lý tài chính doanh nghiệp',
                    '📱 Digital Marketing & Social Media',
                    '👥 Quản lý nhân sự & quy trình',
                    '📊 Phân tích thị trường & đối thủ',
                    '📈 Xây dựng kế hoạch kinh doanh',
                    '🎯 Tối ưu hóa chi phí & hiệu quả',
                    '🔍 SEO & SEM Marketing',
                    '📝 Content Marketing & Branding'
                ],
                teacher: [
                    '🎯 Phương pháp giảng dạy hiện đại',
                    '📋 Quản lý lớp học hiệu quả',
                    '📝 Thiết kế chương trình giảng dạy',
                    '💻 Công nghệ trong giáo dục',
                    '📊 Đánh giá học sinh đa dạng',
                    '🌱 Tạo môi trường học tập tích cực',
                    '🔗 Tích hợp liên môn',
                    '👥 Giao tiếp với phụ huynh'
                ],
                developer: [
                    '⚛️ Frontend Development (React/Vue/Angular)',
                    '🐍 Backend Development (Python/Java/Node.js)',
                    '🗄️ Database & API Design',
                    '🔄 DevOps & CI/CD Pipeline',
                    '☁️ Cloud Platforms (AWS/Azure/GCP)',
                    '🔒 Bảo mật ứng dụng',
                    '🚀 Performance Optimization',
                    '🧪 Testing & Quality Assurance'
                ],
                sales: [
                    '📝 Viết bài post review sản phẩm thu hút',
                    '🎥 Quay/chụp sản phẩm hấp dẫn',
                    '💰 Định giá sản phẩm hợp lý',
                    '💬 Cách nói chuyện với khách hàng',
                    '🤝 Xử lý khách hàng trả giá'
                ],
                office: [
                    '✉️ Gợi ý viết mail chuyên nghiệp',
                    '🗂️ Cách sắp xếp timeline công việc',
                    '📅 Lập kế hoạch tuần hiệu quả',
                    '⏱️ Mẹo quản lý thời gian',
                    '📊 Hàm Excel thông dụng cho văn phòng'
                ],
                other: [
                    'Tìm kiếm & tổng hợp thông tin',
                    'Lên kế hoạch & quản lý công việc',
                    'Tư vấn phát triển kỹ năng',
                    'Brainstorm ý tưởng mới'
                ]
            };
            return suggestions[career] || suggestions.other;
        }

        function addFollowUpQuestions() {
            const career = careerResponses[currentCareer];
            if (!career) return;
            
            const suggestions = getSuggestions(career);
            const messagesContainer = document.getElementById('messages');
            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'flex flex-wrap gap-2 mt-3';
            
            suggestions.forEach((suggestion, index) => {
                const button = document.createElement('button');
                button.className = 'px-3 py-2 bg-blue-100 hover:bg-blue-200 text-blue-800 text-sm rounded-lg transition-colors duration-200 border border-blue-200';
                button.textContent = suggestion;
                button.onclick = () => {
                    // Xóa các button cũ
                    const oldButtons = document.querySelectorAll('.flex.flex-wrap.gap-2');
                    oldButtons.forEach(btn => btn.remove());
                    
                    // Thêm tin nhắn của user
                    addMessage(suggestion, true);
                    
                    // AI trả lời trực tiếp
                    setTimeout(() => {
                        const response = getDirectAIResponse(currentCareer, suggestion);
                        addMessage(response, false);
                    }, 500);
                };
                buttonContainer.appendChild(button);
            });
            
            messagesContainer.appendChild(buttonContainer);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function getDirectAIResponse(career, problem) {
            const careerData = careerResponses[career];
            if (!careerData) return 'Xin lỗi, tôi không thể xử lý yêu cầu này.';
            
            // Lấy thông tin cá nhân đã lưu
            const personalInfo = userProfile.personalInfo || '';
            
            // Tạo phản hồi trực tiếp dựa trên vấn đề và thông tin cá nhân
            let response = `Về vấn đề "${problem}", dựa trên thông tin của ${userProfile.name || 'bạn'}, tôi có những tư vấn sau:\n\n`;
            
            // Thêm tư vấn cụ thể dựa trên nghề nghiệp và vấn đề
            switch(career) {
                case 'farmer':
                    switch(problem) {
                        case '🌾 Trồng lúa miền Tây':
                            response = `Dạ, về trồng lúa ở miền Tây, cháu sẽ hướng dẫn chú/cô chi tiết về bón phân và chăm sóc hiệu quả ạ. Chú/cô muốn biết về thời vụ, bón phân hay chăm sóc ạ?`;
                            break;
                        case '🌶️ Bệnh cây ớt vàng lá':
                            response = `Dạ, về cây ớt bị vàng lá và rụng trái, có thể do nấm hoặc thiếu dinh dưỡng. Cháu sẽ hướng dẫn chú/cô cách xử lý ạ. Chú/cô muốn biết về bệnh, cách xử lý hay dinh dưỡng ạ?`;
                            break;
                        case '🐔 Gà thả vườn bị bệnh':
                            response = `Dạ, về gà thả vườn ăn ít và tiêu chảy, có thể do bệnh hoặc thức ăn. Cháu sẽ hướng dẫn chú/cô cách xử lý ạ. Chú/cô muốn biết về bệnh, cách xử lý hay phòng bệnh ạ?`;
                            break;
                        case '🍈 Kỹ thuật trồng dưa lưới':
                            response = `Dạ, dưa lưới là cây trồng có giá trị kinh tế cao. Cháu sẽ hướng dẫn chú/cô kỹ thuật trồng dưa lưới từ A-Z để đạt năng suất tối ưu ạ. Chú/cô muốn biết về thời vụ, đất trồng, gieo hạt, chăm sóc, thụ phấn, làm giàn, phòng bệnh hay thu hoạch ạ?`;
                            break;
                        case '🌸 Sầu riêng ra hoa bón phân':
                            response = `Dạ, về cây sầu riêng giai đoạn ra hoa, cháu sẽ hướng dẫn chú/cô loại phân phù hợp ạ. Chú/cô muốn biết về bón phân cho hoa hay chăm sóc sầu riêng ạ?`;
                            break;
                        case '☕ Nhắc bón phân cà phê':
                            response = `Dạ, về cây cà phê, cháu sẽ nhắc chú/cô bón phân định kỳ vào sáng thứ Bảy hàng tuần ạ. Chú/cô muốn biết về lịch bón phân hay nhắc nhở ạ?`;
                            break;
                        case '💰 Cập nhật giá nông sản':
                            response = `Dạ, về giá nông sản, cháu sẽ cập nhật thông tin mới nhất cho chú/cô ạ. Chú/cô muốn biết về giá lúa hay giá trái cây ạ?`;
                            break;
                        case '🌤️ Dự báo thời tiết nông vụ':
                            response = `Để xem dự báo thời tiết, vui lòng cho tôi biết tỉnh/thành phố của bạn.\n_(Lưu ý: Đây là dữ liệu giả lập. Trong phiên bản chính thức sẽ kết nối nguồn khí tượng thực tế)._`;
                            break;
                        case '🌿 Kỹ thuật diệt cỏ hiệu quả':
                            response = `🌿 Kỹ thuật diệt cỏ hiệu quả:\n\n👨‍🌾 Diệt cỏ thủ công:\n• Nhổ cỏ bằng tay: Hiệu quả, an toàn\n• Cắt cỏ bằng liềm: Nhanh, tiết kiệm\n• Làm cỏ định kỳ: 2-3 lần/vụ\n• Thời điểm: Sáng sớm hoặc chiều mát\n\n🧪 Thuốc diệt cỏ:\n• Glyphosate: Diệt cỏ toàn diện\n• 2,4-D: Diệt cỏ lá rộng\n• Paraquat: Diệt cỏ tiếp xúc\n• Lưu ý: Đọc kỹ hướng dẫn, bảo hộ đầy đủ\n\n🌱 Diệt cỏ hữu cơ:\n• Muối: Rải muối vào gốc cỏ\n• Giấm: Phun giấm trắng 5%\n• Nước sôi: Đổ nước sôi vào gốc\n• Che phủ: Dùng bạt, rơm rạ\n\n🛡️ Phòng ngừa cỏ:\n• Trồng dày: Giảm ánh sáng đến đất\n• Che phủ: Rơm rạ, bạt nilon\n• Luân canh: Thay đổi cây trồng\n• Vệ sinh: Dọn sạch cỏ quanh vườn`;
                            break;
                        default:
                            response = `Tôi sẵn sàng hỗ trợ. ${name} vui lòng cho tôi biết thêm chi tiết về vấn đề này.`;
                    }
                    break;
                case 'business':
                     switch(problem) {
                        case '💰 Quản lý tài chính doanh nghiệp':
                            response = `Để phân tích, vui lòng cung cấp cho tôi thông tin về ngành hàng và một vài đối thủ chính của ${userProfile.name || 'bạn'}.`;
                            break;
                        case '📱 Digital Marketing & Social Media':
                            response = `Chắc chắn rồi. ${userProfile.name || 'Bạn'} đang quan tâm đến marketing online (Facebook, Google), marketing tại điểm bán hay kênh nào khác?`;
                            break;
                        case '👥 Quản lý nhân sự & quy trình':
                            response = `Để tối ưu chi phí, chúng ta có thể rà soát các khoản chi cho vận hành, nhân sự, marketing... ${userProfile.name || 'Bạn'} có muốn xem qua một checklist các hạng mục cần tối ưu không?`;
                            break;
                        case '📊 Phân tích thị trường & đối thủ':
                            response = `Để phân tích, vui lòng cung cấp cho tôi thông tin về ngành hàng và một vài đối thủ chính của ${userProfile.name || 'bạn'}.`;
                            break;
                        case '📈 Xây dựng kế hoạch kinh doanh':
                            response = `Xây dựng kế hoạch kinh doanh là một bước quan trọng. Chúng ta có thể bắt đầu bằng việc xác định mục tiêu, thị trường, sản phẩm và chiến lược marketing. ${userProfile.name || 'Bạn'} muốn bắt đầu với phần nào trước?`;
                            break;
                        case '🎯 Tối ưu hóa chi phí & hiệu quả':
                            response = `Để tối ưu chi phí, chúng ta có thể rà soát các khoản chi cho vận hành, nhân sự, marketing... ${userProfile.name || 'Bạn'} có muốn xem qua một checklist các hạng mục cần tối ưu không?`;
                            break;
                        case '🔍 SEO & SEM Marketing':
                            response = `Để tối ưu chi phí, chúng ta có thể rà soát các khoản chi cho vận hành, nhân sự, marketing... ${userProfile.name || 'Bạn'} có muốn xem qua một checklist các hạng mục cần tối ưu không?`;
                            break;
                        case '📝 Content Marketing & Branding':
                            response = `Chắc chắn rồi. ${userProfile.name || 'Bạn'} đang quan tâm đến nội dung marketing và xây dựng thương hiệu. Vui lòng cho tôi biết bạn đang làm việc trong lĩnh vực nào để tôi có thể hỗ trợ tốt hơn.`;
                            break;
                        default:
                            response = `Tôi sẵn sàng hỗ trợ. ${userProfile.name || 'Bạn'} vui lòng cho tôi biết thêm chi tiết về vấn đề này.`;
                    }
                    break;
                case 'sales':
                    switch(problem) {
                        case '📝 Viết bài post review sản phẩm thu hút':
                            response = `📝 **Cách viết bài post review sản phẩm thu hút:**\n\n- Bắt đầu bằng một câu chuyện thực tế hoặc cảm xúc cá nhân\n- Đưa ra vấn đề mà sản phẩm giải quyết\n- Mô tả trải nghiệm sử dụng: hình ảnh, cảm nhận, kết quả\n- Đưa ra bằng chứng (ảnh/video, feedback khách hàng)\n- Kêu gọi hành động: \"Inbox để được tư vấn chi tiết!\"\n\n**Ví dụ:**\n\"Từ ngày dùng máy xay này, sáng nào cũng có ly sinh tố mát lạnh chỉ sau 2 phút. Ai lười như mình nên thử nhé!\"`;
                            break;
                        case '🎥 Quay/chụp sản phẩm hấp dẫn':
                            response = `🎥 **Mẹo quay/chụp sản phẩm hấp dẫn:**\n\n- Chọn nền sáng, đơn giản để làm nổi bật sản phẩm\n- Sử dụng ánh sáng tự nhiên hoặc đèn led\n- Quay/chụp nhiều góc: tổng thể, cận cảnh chi tiết, khi sử dụng thực tế\n- Thêm đạo cụ hoặc tay người để tạo cảm giác thật\n- Video nên ngắn gọn, tập trung vào điểm mạnh sản phẩm\n\n**App gợi ý:** CapCut, InShot, Lightroom Mobile.`;
                            break;
                        case '💰 Định giá sản phẩm hợp lý':
                            response = `💰 **Cách định giá sản phẩm hợp lý:**\n\n- Tính tổng chi phí (giá nhập, vận chuyển, đóng gói, marketing...)\n- Tham khảo giá thị trường, đối thủ\n- Xác định giá trị gia tăng (dịch vụ, bảo hành, quà tặng kèm)\n- Đặt giá có thể linh hoạt (giá niêm yết, giá ưu đãi, combo)\n- Đừng quên tính lợi nhuận mong muốn!`;
                            break;
                        case '💬 Cách nói chuyện với khách hàng':
                            response = `💬 **Cách nói chuyện với khách hàng:**\n\n- Chào hỏi thân thiện, xưng hô phù hợp\n- Lắng nghe kỹ nhu cầu, đặt câu hỏi mở\n- Tư vấn đúng trọng tâm, không nói lan man\n- Luôn xác nhận lại thông tin đơn hàng\n- Kết thúc bằng lời cảm ơn và nhắc nhở ưu đãi nếu có\n\n**Ví dụ:**\n\"Dạ em cảm ơn chị đã quan tâm, chị cần tư vấn về mẫu nào ạ?\"`;
                            break;
                        case '🤝 Xử lý khách hàng trả giá':
                            response = `🤝 **Cách xử lý khách hàng trả giá:**\n\n- Luôn giữ thái độ vui vẻ, tôn trọng\n- Giải thích lý do giá (chất lượng, dịch vụ, bảo hành...)\n- Đưa ra ưu đãi nhỏ (freeship, quà tặng, giảm giá nhẹ nếu hợp lý)\n- Nếu không thể giảm, hãy nhấn mạnh giá trị sản phẩm\n- Đừng quên cảm ơn khách dù có chốt đơn hay không!`;
                            break;
                        default:
                            response = `Tôi sẵn sàng hỗ trợ. ${name} vui lòng cho tôi biết thêm chi tiết về vấn đề này.`;
                    }
                            break;
                case 'office':
                    switch(problem) {
                        case '✉️ Gợi ý viết mail chuyên nghiệp':
                            response = `✉️ **Gợi ý viết mail chuyên nghiệp:**\n\n- Tiêu đề rõ ràng, ngắn gọn (VD: [ACTION] Yêu cầu báo cáo tuần)\n- Lời chào trang trọng: "Kính gửi Anh/Chị..."\n- Nội dung: Trình bày mạch lạc, chia đoạn, gạch đầu dòng\n- Kết thúc: "Trân trọng,", "Best regards,"\n- Chữ ký: Họ tên, chức vụ, công ty, số điện thoại\n\n**Mẹo:** Luôn kiểm tra lại lỗi chính tả và tệp đính kèm trước khi gửi!`;
                            break;
                        case '🗂️ Cách sắp xếp timeline công việc':
                            response = `🗂️ **Cách sắp xếp timeline công việc:**\n\n1. Liệt kê tất cả các đầu việc cần làm\n2. Ưu tiên theo mức độ quan trọng/khẩn cấp (Ma trận Eisenhower)\n3. Chia nhỏ công việc lớn thành các bước nhỏ\n4. Sử dụng công cụ: Google Calendar, Trello, Notion...\n5. Đặt deadline rõ ràng cho từng nhiệm vụ\n6. Đánh giá lại tiến độ mỗi cuối ngày/tuần`;
                            break;
                        case '📅 Lập kế hoạch tuần hiệu quả':
                            response = `📅 **Lập kế hoạch tuần hiệu quả:**\n\n- Đầu tuần: Xác định 3 mục tiêu lớn nhất\n- Chia nhỏ mục tiêu thành các task hàng ngày\n- Sắp xếp lịch họp, deadline, công việc cá nhân\n- Để thời gian dự phòng cho việc phát sinh\n- Cuối tuần: Tổng kết, rút kinh nghiệm, điều chỉnh kế hoạch tuần sau`;
                            break;
                        case '⏱️ Mẹo quản lý thời gian':
                            response = `⏱️ **Mẹo quản lý thời gian:**\n\n- Kỹ thuật Pomodoro: 25 phút tập trung, 5 phút nghỉ\n- Time blocking: Chia khung giờ cho từng loại việc\n- Ưu tiên việc quan trọng trước (Eat That Frog)\n- Hạn chế đa nhiệm, tắt thông báo khi làm việc\n- Tổng kết cuối ngày để điều chỉnh thói quen`;
                            break;
                        case '📊 Hàm Excel thông dụng cho văn phòng':
                            response = `📊 **Hàm Excel thông dụng:**\n\n- SUM, AVERAGE, COUNT: Tính tổng, trung bình, đếm\n- IF: Hàm điều kiện\n- VLOOKUP/HLOOKUP: Tìm kiếm dữ liệu\n- CONCATENATE: Nối chuỗi\n- PIVOTTABLE: Tổng hợp, phân tích dữ liệu\n\n**Phím tắt hay:** Ctrl+T (tạo bảng), Ctrl+Shift+L (lọc), Alt+= (AutoSum)`;
                            break;
                        default:
                            response = `Tôi sẵn sàng hỗ trợ. ${userProfile.name || 'bạn'} vui lòng cho tôi biết thêm chi tiết về vấn đề này.`;
                    }
                    break;
                default:
                    response = `Tôi đã ghi nhận yêu cầu của bạn về "${problem}". Vui lòng cung cấp thêm chi tiết để tôi có thể hỗ trợ tốt nhất.`;
            }
            return response;
        }

        function handleProblemSelection(problem) {
            // Thêm tin nhắn người dùng
            addMessage(problem, true);
            
            // Lưu vấn đề được chọn
            userProfile.selectedProblem = problem;
            
            // AI phản hồi và yêu cầu thông tin chi tiết
            setTimeout(() => {
                const response = getProblemResponse(problem);
                addMessage(response, false);
                
                // Hiển thị form cung cấp thông tin
                setTimeout(() => {
                    addInformationForm(problem);
                }, 1000);
            }, 1000);
        }

        function getProblemResponse(problem) {
            const responses = {
                'Chú/cô đang trồng loại cây gì?': 'Dạ, cháu hiểu chú/cô muốn tư vấn về cây trồng. Hãy cho cháu biết thêm thông tin chi tiết ạ.',
                'Diện tích canh tác của chú/cô là bao nhiêu?': 'Dạ, diện tích canh tác rất quan trọng để cháu đưa ra tư vấn phù hợp. Hãy cung cấp thông tin chi tiết ạ.',
                'Chú/cô gặp khó khăn gì về sâu bệnh?': 'Dạ, sâu bệnh là vấn đề phổ biến trong nông nghiệp. Hãy mô tả chi tiết tình trạng hiện tại ạ.',
                'Chú/cô muốn tăng năng suất như thế nào?': 'Dạ, tăng năng suất là mục tiêu quan trọng. Hãy cho cháu biết tình hình hiện tại ạ.',
                'Thời tiết hiện tại ảnh hưởng gì đến cây trồng?': 'Dạ, thời tiết ảnh hưởng lớn đến cây trồng. Hãy mô tả tình hình cụ thể ạ.',
                'Chú/cô có nuôi gà, vịt gì không?': 'Dạ, chăn nuôi gia cầm cũng rất quan trọng trong nông nghiệp. Cháu sẽ hướng dẫn chú/cô cách chăm sóc và phòng bệnh hiệu quả ạ.',
                'Chú/cô muốn biết về kỹ thuật trồng dưa lưới không?': 'Dạ, dưa lưới là cây trồng có giá trị kinh tế cao. Cháu sẽ hướng dẫn chú/cô kỹ thuật trồng từ A-Z ạ.',
                'Chú/cô cần thông tin giá nông sản không?': 'Dạ, cháu sẽ cập nhật thông tin giá nông sản mới nhất cho chú/cô ạ.',
                'Bạn kinh doanh lĩnh vực gì?': 'Tôi sẽ giúp bạn phát triển chiến lược kinh doanh. Hãy cung cấp thông tin chi tiết.',
                'Quy mô doanh nghiệp của bạn?': 'Quy mô doanh nghiệp ảnh hưởng đến chiến lược. Hãy cho tôi biết thêm.',
                'Bạn gặp khó khăn gì trong marketing?': 'Marketing là chìa khóa thành công. Hãy mô tả khó khăn cụ thể.',
                'Bạn muốn mở rộng thị trường như thế nào?': 'Mở rộng thị trường cần chiến lược phù hợp. Hãy cung cấp thông tin.',
                'Doanh thu hiện tại của bạn ra sao?': 'Doanh thu phản ánh hiệu quả kinh doanh. Hãy chia sẻ tình hình.',
                'Bạn dạy môn học gì?': 'Tôi sẽ giúp bạn cải thiện phương pháp giảng dạy. Hãy cung cấp thông tin.',
                'Bạn dạy cấp học nào?': 'Mỗi cấp học có đặc thù riêng. Hãy cho tôi biết thêm.',
                'Bạn gặp khó khăn gì trong giảng dạy?': 'Giảng dạy có nhiều thách thức. Hãy mô tả khó khăn cụ thể.',
                'Bạn muốn cải thiện phương pháp dạy như thế nào?': 'Cải thiện phương pháp dạy là mục tiêu tốt. Hãy chia sẻ.',
                'Sĩ số lớp học của bạn là bao nhiêu?': 'Sĩ số ảnh hưởng đến phương pháp dạy. Hãy cung cấp thông tin.',
                'Bạn chuyên về ngôn ngữ lập trình nào?': 'Tôi sẽ giúp bạn với coding. Hãy cung cấp thông tin chi tiết.',
                'Bạn làm frontend hay backend?': 'Frontend và backend có đặc thù khác nhau. Hãy cho tôi biết thêm.',
                'Bạn gặp khó khăn gì trong coding?': 'Coding có nhiều thách thức. Hãy mô tả vấn đề cụ thể.',
                'Bạn muốn học framework mới nào?': 'Framework mới giúp nâng cao kỹ năng. Hãy chia sẻ mục tiêu.',
                'Dự án hiện tại bạn đang làm là gì?': 'Dự án hiện tại rất quan trọng. Hãy cung cấp thông tin.',
                'Bạn chuyên khoa gì?': 'Tôi sẽ hỗ trợ bạn trong lĩnh vực y tế. Hãy cung cấp thông tin.',
                'Bạn làm việc ở bệnh viện hay phòng khám?': 'Môi trường làm việc ảnh hưởng đến phương pháp. Hãy cho tôi biết.',
                'Bạn gặp khó khăn gì trong chẩn đoán?': 'Chẩn đoán là kỹ năng quan trọng. Hãy mô tả khó khăn.',
                'Bạn muốn cập nhật kiến thức y học như thế nào?': 'Cập nhật kiến thức là cần thiết. Hãy chia sẻ mục tiêu.',
                'Số lượng bệnh nhân trung bình mỗi ngày?': 'Số lượng bệnh nhân ảnh hưởng đến quy trình. Hãy cung cấp thông tin.',
                'Bạn chuyên về lĩnh vực pháp lý nào?': 'Tôi sẽ hỗ trợ bạn trong lĩnh vực pháp lý. Hãy cung cấp thông tin.',
                'Bạn làm việc độc lập hay công ty luật?': 'Loại hình làm việc ảnh hưởng đến phương pháp. Hãy cho tôi biết.',
                'Bạn gặp khó khăn gì trong tư vấn?': 'Tư vấn pháp lý có nhiều thách thức. Hãy mô tả khó khăn.',
                'Bạn muốn mở rộng chuyên môn như thế nào?': 'Mở rộng chuyên môn là mục tiêu tốt. Hãy chia sẻ.',
                'Loại vụ án bạn thường xử lý là gì?': 'Loại vụ án ảnh hưởng đến chuyên môn. Hãy cung cấp thông tin.',
                'Bạn làm việc trong lĩnh vực gì?': 'Tôi sẽ hỗ trợ bạn trong công việc. Hãy cung cấp thông tin.',
                'Công việc hiện tại của bạn như thế nào?': 'Công việc hiện tại rất quan trọng. Hãy cho tôi biết thêm.',
                'Bạn gặp khó khăn gì trong công việc?': 'Mỗi công việc có thách thức riêng. Hãy mô tả khó khăn.',
                'Bạn muốn phát triển kỹ năng gì?': 'Phát triển kỹ năng là mục tiêu tốt. Hãy chia sẻ.',
                'Mục tiêu nghề nghiệp của bạn là gì?': 'Mục tiêu nghề nghiệp định hướng phát triển. Hãy cung cấp thông tin.'
            };
            
            return responses[problem] || 'Tôi hiểu vấn đề của bạn. Hãy cung cấp thông tin chi tiết để tôi có thể hỗ trợ tốt hơn.';
        }

        function addInformationForm(problem) {
            const messagesContainer = document.getElementById('messages');
            const formDiv = document.createElement('div');
            formDiv.className = 'flex justify-start';
            
            const formBubble = document.createElement('div');
            formBubble.className = 'message-bubble px-4 py-3 rounded-2xl shadow-sm bg-green-50 border border-green-200';
            
            const formTitle = document.createElement('p');
            formTitle.className = 'text-sm text-gray-700 mb-3 font-medium';
            formTitle.textContent = `Về vấn đề "${problem}", hãy cho tôi biết thêm chi tiết:`;
            
            const form = document.createElement('form');
            form.className = 'space-y-3';
            form.onsubmit = (e) => {
                e.preventDefault();
                const details = form.querySelector('textarea').value;
                if (details.trim()) {
                    // Xóa form
                    formDiv.remove();
                    
                    // Thêm tin nhắn của user
                    addMessage(details, true);
                    
                    // Gửi phản hồi AI
                    setTimeout(() => {
                        const response = getAIResponse(currentCareer, problem, details);
                        addMessage(response, false);
                    }, 500);
                }
            };
            
            const textarea = document.createElement('textarea');
            textarea.className = 'w-full p-3 border border-gray-300 rounded-lg text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent';
            textarea.placeholder = 'Mô tả chi tiết vấn đề của bạn...';
            textarea.rows = 3;
            textarea.required = true;
            
            const submitButton = document.createElement('button');
            submitButton.type = 'submit';
            submitButton.className = 'px-4 py-2 bg-blue-500 text-white rounded-lg text-sm hover:bg-blue-600 transition-colors';
            submitButton.textContent = 'Gửi';
            
            form.appendChild(textarea);
            form.appendChild(submitButton);
            formBubble.appendChild(formTitle);
            formBubble.appendChild(form);
            formDiv.appendChild(formBubble);
            messagesContainer.appendChild(formDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Focus vào textarea
            setTimeout(() => {
                textarea.focus();
            }, 100);
        }

        function addDetailForm(problem) {
            const messagesContainer = document.getElementById('messages');
            const formDiv = document.createElement('div');
            formDiv.className = 'flex justify-start';
            
            const formBubble = document.createElement('div');
            formBubble.className = 'message-bubble px-4 py-3 rounded-2xl shadow-sm bg-green-50 border border-green-200';
            
            const formTitle = document.createElement('p');
            formTitle.className = 'text-sm text-gray-700 mb-3 font-medium';
            formTitle.textContent = `Về vấn đề "${problem}", hãy cho tôi biết thêm chi tiết:`;
            
            const form = document.createElement('form');
            form.className = 'space-y-3';
            form.onsubmit = (e) => {
                e.preventDefault();
                const details = form.querySelector('textarea').value;
                if (details.trim()) {
                    // Xóa form
                    formDiv.remove();
                    
                    // Thêm tin nhắn của user
                    addMessage(details, true);
                    
                    // Gửi phản hồi AI
                    setTimeout(() => {
                        const response = getAIResponse(currentCareer, problem, details);
                        addMessage(response, false);
                    }, 500);
                }
            };
            
            const textarea = document.createElement('textarea');
            textarea.className = 'w-full p-3 border border-gray-300 rounded-lg text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent';
            textarea.placeholder = 'Mô tả chi tiết vấn đề của bạn...';
            textarea.rows = 3;
            textarea.required = true;
            
            const submitButton = document.createElement('button');
            submitButton.type = 'submit';
            submitButton.className = 'px-4 py-2 bg-blue-500 text-white rounded-lg text-sm hover:bg-blue-600 transition-colors';
            submitButton.textContent = 'Gửi';
            
            form.appendChild(textarea);
            form.appendChild(submitButton);
            formBubble.appendChild(formTitle);
            formBubble.appendChild(form);
            formDiv.appendChild(formBubble);
            messagesContainer.appendChild(formDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Focus vào textarea
            setTimeout(() => {
                textarea.focus();
            }, 100);
        }

        function changeCareer() {
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('careerSelection').classList.remove('hidden');
            document.getElementById('messages').innerHTML = '';
        }

        function shareApp() {
            if (navigator.share) {
                navigator.share({
                    title: 'V AI',
                    text: 'Trợ lý AI thông minh cho mọi nghề nghiệp',
                    url: window.location.href
                });
            }
        }

        function addMessage(text, isUser) {
            console.log('addMessage called:', text, isUser); // Debug log
            
            const messagesContainer = document.getElementById('messages');
            console.log('messagesContainer:', messagesContainer); // Debug log
            
            if (!messagesContainer) {
                console.error('messagesContainer not found!'); // Debug log
                return;
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${isUser ? 'justify-end' : 'justify-start'}`;
            
            const messageBubble = document.createElement('div');
            messageBubble.className = `message-bubble px-4 py-3 rounded-2xl shadow-sm ${
                isUser
                    ? 'bg-blue-500 text-white'
                    : 'bg-gray-100 text-gray-800 border border-gray-200'
            }`;
            
            const messageText = document.createElement('p');
            messageText.className = 'whitespace-pre-wrap text-sm leading-relaxed';
            messageText.textContent = text;
            
            messageBubble.appendChild(messageText);
            messageDiv.appendChild(messageBubble);
            messagesContainer.appendChild(messageDiv);
            
            console.log('Message added successfully'); // Debug log
            
            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function addTypingIndicator() {
            const messagesContainer = document.getElementById('messages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'flex justify-start';
            typingDiv.id = 'typing-indicator';
            
            const typingBubble = document.createElement('div');
            typingBubble.className = 'bg-gray-100 text-gray-800 px-4 py-3 rounded-2xl border border-gray-200';
            
            const dots = document.createElement('div');
            dots.className = 'flex items-center space-x-1';
            dots.innerHTML = `
                <div class="w-2 h-2 bg-gray-400 rounded-full typing-animation"></div>
                <div class="w-2 h-2 bg-gray-400 rounded-full typing-animation" style="animation-delay: 0.1s"></div>
                <div class="w-2 h-2 bg-gray-400 rounded-full typing-animation" style="animation-delay: 0.2s"></div>
            `;
            
            typingBubble.appendChild(dots);
            typingDiv.appendChild(typingBubble);
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        function getAIResponse(career, problem, details) {
            const careerData = careerResponses[career];
            if (!careerData) return 'Xin lỗi, tôi không thể xử lý yêu cầu này.';
            
            // Lưu thông tin user
            userProfile.career = career;
            userProfile.problem = problem;
            userProfile.details = details;
            localStorage.setItem('userProfile', JSON.stringify(userProfile));
            
            // Lấy thông tin cá nhân đã lưu
            const personalInfo = userProfile.personalInfo || '';
            
            // Tạo phản hồi dựa trên nghề nghiệp và vấn đề
            let response = `Cảm ơn bạn đã chia sẻ thông tin về vấn đề "${problem}". `;
            
            // Thêm tư vấn cụ thể dựa trên nghề nghiệp và thông tin cá nhân
            switch(career) {
                case 'farmer':
                    response += `Dạ, dựa trên thông tin cá nhân của chú/cô và vấn đề "${problem}", cháu có một số gợi ý:
                    
• **Phân tích tình huống**: ${details}
• **Giải pháp đề xuất**: Áp dụng kỹ thuật canh tác hiện đại phù hợp với điều kiện của chú/cô
• **Tài nguyên hữu ích**: Tham khảo các mô hình nông nghiệp bền vững
• **Bước tiếp theo**: Theo dõi và đánh giá kết quả

Chú/cô có muốn cháu tư vấn thêm về vấn đề khác không ạ?`;
                    break;
                    
                case 'business':
                    response += `Dựa trên tình hình kinh doanh của bạn và vấn đề "${problem}", tôi có một số tư vấn:
                    
• **Phân tích thị trường**: Đánh giá cơ hội và rủi ro phù hợp với quy mô của bạn
• **Chiến lược đề xuất**: Phát triển kế hoạch hành động cụ thể
• **Quản lý rủi ro**: Xây dựng các biện pháp bảo vệ
• **Đo lường thành công**: Thiết lập các chỉ số KPI phù hợp

Bạn có muốn tôi tư vấn thêm về chiến lược kinh doanh không?`;
                    break;
                    
                case 'teacher':
                    response += `Dựa trên môi trường giảng dạy của bạn và vấn đề "${problem}", tôi có một số gợi ý:
                    
• **Phương pháp giảng dạy**: Áp dụng các kỹ thuật hiện đại phù hợp với cấp học và môn học
• **Quản lý lớp học**: Xây dựng môi trường học tập tích cực
• **Đánh giá học sinh**: Phát triển hệ thống đánh giá toàn diện
• **Phát triển chuyên môn**: Cập nhật kiến thức và kỹ năng

Bạn có muốn tôi tư vấn thêm về phương pháp giảng dạy không?`;
                    break;
                    
                case 'developer':
                    response += `Dựa trên stack công nghệ và dự án của bạn, với vấn đề "${problem}", tôi có một số tư vấn:
                    
• **Phân tích kỹ thuật**: Đánh giá vấn đề và giải pháp phù hợp với công nghệ bạn đang sử dụng
• **Công nghệ phù hợp**: Lựa chọn stack công nghệ tối ưu
• **Quy trình phát triển**: Áp dụng các phương pháp agile
• **Bảo trì và nâng cấp**: Xây dựng hệ thống bền vững

Bạn có muốn tôi tư vấn thêm về công nghệ không?`;
                    break;
                    
                case 'doctor':
                    response += `Dựa trên chuyên môn và môi trường làm việc của bạn, với vấn đề "${problem}", tôi có một số gợi ý:
                    
• **Cập nhật kiến thức**: Theo dõi các tiến bộ y học mới trong chuyên khoa của bạn
• **Phương pháp chẩn đoán**: Áp dụng công nghệ hiện đại phù hợp với môi trường làm việc
• **Chăm sóc bệnh nhân**: Cải thiện trải nghiệm điều trị
• **Nghiên cứu y học**: Tham gia các dự án nghiên cứu

Bạn có muốn tôi tư vấn thêm về chuyên môn y tế không?`;
                    break;
                    
                case 'lawyer':
                    response += `Dựa trên lĩnh vực pháp lý và kinh nghiệm của bạn, với vấn đề "${problem}", tôi có một số tư vấn:
                    
• **Phân tích pháp lý**: Đánh giá tình huống và rủi ro trong lĩnh vực chuyên môn
• **Chiến lược bảo vệ**: Xây dựng lập luận vững chắc
• **Cập nhật luật pháp**: Theo dõi các thay đổi pháp lý trong lĩnh vực của bạn
• **Tư vấn khách hàng**: Cải thiện kỹ năng giao tiếp

Bạn có muốn tôi tư vấn thêm về vấn đề pháp lý không?`;
                    break;
                    
                default:
                    response += `Dựa trên thông tin bạn cung cấp về "${problem}" và "${details}", tôi có một số tư vấn chung:
                    
• **Phân tích vấn đề**: Hiểu rõ nguyên nhân và tác động
• **Giải pháp đề xuất**: Xây dựng kế hoạch hành động
• **Tài nguyên hỗ trợ**: Tìm kiếm thông tin và chuyên gia
• **Theo dõi tiến độ**: Đánh giá và điều chỉnh kế hoạch

Bạn có muốn tôi tư vấn thêm về vấn đề khác không?`;
            }
            
            return response;
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (text && !isTyping) {
                addMessage(text, true);
                input.value = '';
                
                isTyping = true;
                addTypingIndicator();
                
                // Simulate AI thinking
                setTimeout(() => {
                    removeTypingIndicator();
                    const response = generateAIResponse(text);
                    addMessage(response, false);
                    isTyping = false;
                    
                    // Bỏ phần hiển thị lại form
                    // setTimeout(() => {
                    //     showContinueForm();
                    // }, 1000);
                }, 1500);
            }
        }

        function generateAIResponse(userInput) {
            const input = userInput.toLowerCase();
            const name = userProfile.name || 'chú/cô';
            const careerData = careerResponses[currentCareer];

            if (input.includes('chào') || input.includes('hello')) {
                return `Chào ${name}, cháu NôngTrí đây ạ! Chú/cô cần cháu hỗ trợ vấn đề gì hôm nay?`;
            }

            // Xử lý các chủ đề nông nghiệp chi tiết
            if (currentCareer === 'farmer') {
                // Dưa lưới
                if (input.includes('dưa lưới') || input.includes('melon')) {
                    let ans = '';
                    if (careerData.melon) {
                        ans += '🍈 Đặc điểm & kỹ thuật trồng dưa lưới:\n';
                        if (input.match(/(thời vụ|mùa vụ|trồng khi nào)/)) ans += careerData.melon.detailed.season + '\n';
                        if (input.match(/(đất|đất trồng|chuẩn bị đất)/)) ans += careerData.melon.detailed.soil + '\n';
                        if (input.match(/(gieo|hạt|ươm)/)) ans += careerData.melon.detailed.seeding + '\n';
                        if (input.match(/(chăm sóc|tưới|bón phân)/)) ans += careerData.melon.detailed.care + '\n';
                        if (input.match(/(thụ phấn|phấn|hoa)/)) ans += careerData.melon.detailed.pollination + '\n';
                        if (input.match(/(giàn|leo|treo)/)) ans += careerData.melon.detailed.trellis + '\n';
                        if (input.match(/(bệnh|sâu|phòng bệnh)/)) ans += careerData.melon.detailed.disease + '\n';
                        if (input.match(/(thu hoạch|hái|chín)/)) ans += careerData.melon.detailed.harvest + '\n';
                        // Nếu không có từ khóa cụ thể, trả lời tất cả các mục
                        if (ans.trim() === '🍈 Đặc điểm & kỹ thuật trồng dưa lưới:') {
                            ans += careerData.melon.detailed.season + '\n' + careerData.melon.detailed.soil + '\n' + careerData.melon.detailed.seeding + '\n' + careerData.melon.detailed.care + '\n' + careerData.melon.detailed.pollination + '\n' + careerData.melon.detailed.trellis + '\n' + careerData.melon.detailed.disease + '\n' + careerData.melon.detailed.harvest + '\n';
                        }
                        if (careerData.melon.tips) {
                            ans += '\n💡 Mẹo hay:\n- ' + careerData.melon.tips.join('\n- ');
                        }
                        return ans;
                    }
                }
                // Lúa
                if (input.includes('lúa') || input.includes('rice')) {
                    let ans = '';
                    if (careerData.rice) {
                        ans += '🌾 Kỹ thuật trồng lúa miền Tây:\n';
                        if (input.match(/(thời vụ|mùa vụ)/)) ans += careerData.rice.detailed.season + '\n';
                        if (input.match(/(phân|bón phân)/)) ans += careerData.rice.detailed.fertilizer + '\n';
                        if (input.match(/(chăm sóc|tưới)/)) ans += careerData.rice.detailed.care + '\n';
                        if (ans === '🌾 Kỹ thuật trồng lúa miền Tây:\n') {
                            ans += careerData.rice.detailed.season + '\n' + careerData.rice.detailed.fertilizer + '\n' + careerData.rice.detailed.care + '\n';
                        }
                        return ans;
                    }
                }
                // Ớt
                if (input.includes('ớt') || input.includes('chili') || input.includes('vàng lá') || input.includes('rụng trái')) {
                    let ans = '';
                    if (careerData.chili) {
                        ans += '🌶️ Kỹ thuật & phòng bệnh cây ớt:\n';
                        if (input.match(/(bệnh|nấm)/)) ans += careerData.chili.detailed.disease + '\n';
                        if (input.match(/(xử lý|trị)/)) ans += careerData.chili.detailed.treatment + '\n';
                        if (input.match(/(dinh dưỡng|phân)/)) ans += careerData.chili.detailed.nutrition + '\n';
                        if (ans === '🌶️ Kỹ thuật & phòng bệnh cây ớt:\n') {
                            ans += careerData.chili.detailed.disease + '\n' + careerData.chili.detailed.treatment + '\n' + careerData.chili.detailed.nutrition + '\n';
                        }
                        return ans;
                    }
                }
                // Gà
                if (input.includes('gà') || input.includes('chicken') || input.includes('tiêu chảy') || input.includes('ăn ít')) {
                    let ans = '';
                    if (careerData.chicken) {
                        ans += '🐔 Chăm sóc & phòng bệnh gà thả vườn:\n';
                        if (input.match(/(bệnh)/)) ans += careerData.chicken.detailed.disease + '\n';
                        if (input.match(/(xử lý|trị)/)) ans += careerData.chicken.detailed.treatment + '\n';
                        if (input.match(/(phòng|ngừa)/)) ans += careerData.chicken.detailed.prevention + '\n';
                        if (ans === '🐔 Chăm sóc & phòng bệnh gà thả vườn:\n') {
                            ans += careerData.chicken.detailed.disease + '\n' + careerData.chicken.detailed.treatment + '\n' + careerData.chicken.detailed.prevention + '\n';
                        }
                        return ans;
                    }
                }
                // Sầu riêng
                if (input.includes('sầu riêng') || input.includes('durian') || input.includes('ra hoa')) {
                    let ans = '';
                    if (careerData.durian) {
                        ans += '🌸 Kỹ thuật chăm sóc sầu riêng ra hoa:\n';
                        if (input.match(/(hoa|phân)/)) ans += careerData.durian.detailed.flowering + '\n';
                        if (input.match(/(chăm sóc)/)) ans += careerData.durian.detailed.care + '\n';
                        if (ans === '🌸 Kỹ thuật chăm sóc sầu riêng ra hoa:\n') {
                            ans += careerData.durian.detailed.flowering + '\n' + careerData.durian.detailed.care + '\n';
                        }
                        return ans;
                    }
                }
                // Cà phê
                if (input.includes('cà phê') || input.includes('coffee') || input.includes('bón phân')) {
                    let ans = '';
                    if (careerData.coffee) {
                        ans += '☕ Lịch bón phân & chăm sóc cà phê:\n';
                        if (input.match(/(lịch|lịch trình)/)) ans += careerData.coffee.detailed.schedule + '\n';
                        if (input.match(/(nhắc|nhớ)/)) ans += careerData.coffee.detailed.reminder + '\n';
                        if (ans === '☕ Lịch bón phân & chăm sóc cà phê:\n') {
                            ans += careerData.coffee.detailed.schedule + '\n' + careerData.coffee.detailed.reminder + '\n';
                        }
                        return ans;
                    }
                }
                // Giá cả
                if (input.includes('giá') || input.includes('price') || input.includes('thị trường')) {
                    let ans = '';
                    if (careerData.price) {
                        ans += '💰 Giá nông sản mới nhất:\n';
                        if (input.match(/(lúa)/)) ans += careerData.price.detailed.rice + '\n';
                        if (input.match(/(trái cây|hoa quả)/)) ans += careerData.price.detailed.fruit + '\n';
                        if (ans === '💰 Giá nông sản mới nhất:\n') {
                            ans += careerData.price.detailed.rice + '\n' + careerData.price.detailed.fruit + '\n';
                        }
                        return ans;
                    }
                }
                // Thời tiết
                if (input.includes('thời tiết') || input.includes('weather') || input.includes('nhiệt độ')) {
                    return careerData.weather[Math.floor(Math.random() * careerData.weather.length)];
                }
                // Kỹ thuật canh tác
                if (input.includes('canh tác') || input.includes('trồng trọt') || input.includes('năng suất')) {
                    return careerData.farming[Math.floor(Math.random() * careerData.farming.length)];
                }
                // Sâu bệnh
                if (input.includes('sâu bệnh') || input.includes('phòng bệnh') || input.includes('thuốc')) {
                    return careerData.pest[Math.floor(Math.random() * careerData.pest.length)];
                }
                // Diệt cỏ
                if (input.includes('diệt cỏ') || input.includes('cỏ') || input.includes('weed')) {
                    let ans = '';
                    if (careerData.weed) {
                        ans += '🌿 Kỹ thuật diệt cỏ hiệu quả:\n';
                        if (input.match(/(thủ công|nhổ|tay)/)) ans += careerData.weed.detailed.manual + '\n';
                        if (input.match(/(thuốc|hóa học|glyphosate)/)) ans += careerData.weed.detailed.chemical + '\n';
                        if (input.match(/(hữu cơ|tự nhiên|muối|giấm)/)) ans += careerData.weed.detailed.organic + '\n';
                        if (input.match(/(phòng|ngừa|che phủ)/)) ans += careerData.weed.detailed.prevention + '\n';
                        if (ans === '🌿 Kỹ thuật diệt cỏ hiệu quả:\n') {
                            ans += careerData.weed.detailed.manual + '\n' + careerData.weed.detailed.chemical + '\n' + careerData.weed.detailed.organic + '\n' + careerData.weed.detailed.prevention + '\n';
                        }
                        return ans;
                    }
                }
            }

            if (careerData) {
                // Xử lý các ngành khác với dữ liệu chi tiết
                if (currentCareer === 'business') {
                    // Tài chính
                    if (input.includes('tài chính') || input.includes('finance') || input.includes('quản lý tiền')) {
                        let ans = '';
                        if (careerData.finance) {
                            ans += '💰 Quản lý tài chính doanh nghiệp:\n';
                            if (input.match(/(kế hoạch|lập kế hoạch)/)) ans += careerData.finance.detailed.planning + '\n';
                            if (input.match(/(chi phí|cost)/)) ans += careerData.finance.detailed.cost + '\n';
                            if (input.match(/(đầu tư|investment)/)) ans += careerData.finance.detailed.investment + '\n';
                            if (ans === '💰 Quản lý tài chính doanh nghiệp:\n') {
                                ans += careerData.finance.detailed.planning + '\n' + careerData.finance.detailed.cost + '\n' + careerData.finance.detailed.investment + '\n';
                            }
                            return ans;
                        }
                    }
                    // Digital Marketing
                    if (input.includes('digital') || input.includes('marketing') || input.includes('quảng cáo')) {
                        let ans = '';
                        if (careerData.digital) {
                            ans += '📱 Digital Marketing:\n';
                            if (input.match(/(social|facebook|instagram|tiktok)/)) ans += careerData.digital.detailed.social + '\n';
                            if (input.match(/(content|blog|video)/)) ans += careerData.digital.detailed.content + '\n';
                            if (input.match(/(seo|sem|từ khóa)/)) ans += careerData.digital.detailed.seo + '\n';
                            if (ans === '📱 Digital Marketing:\n') {
                                ans += careerData.digital.detailed.social + '\n' + careerData.digital.detailed.content + '\n' + careerData.digital.detailed.seo + '\n';
                            }
                            return ans;
                        }
                    }
                    // Quản lý
                    if (input.includes('quản lý') || input.includes('management') || input.includes('nhân sự')) {
                        let ans = '';
                        if (careerData.management) {
                            ans += '👥 Quản lý doanh nghiệp:\n';
                            if (input.match(/(nhân sự|team|tuyển dụng)/)) ans += careerData.management.detailed.team + '\n';
                            if (input.match(/(quy trình|process|tối ưu)/)) ans += careerData.management.detailed.process + '\n';
                            if (input.match(/(chất lượng|quality)/)) ans += careerData.management.detailed.quality + '\n';
                            if (ans === '👥 Quản lý doanh nghiệp:\n') {
                                ans += careerData.management.detailed.team + '\n' + careerData.management.detailed.process + '\n' + careerData.management.detailed.quality + '\n';
                            }
                            return ans;
                        }
                    }
                }
                
                if (currentCareer === 'teacher') {
                    // Phương pháp giảng dạy
                    if (input.includes('phương pháp') || input.includes('methodology') || input.includes('giảng dạy')) {
                        let ans = '';
                        if (careerData.methodology) {
                            ans += '🎯 Phương pháp giảng dạy hiện đại:\n';
                            if (input.match(/(chủ động|active|project)/)) ans += careerData.methodology.detailed.active + '\n';
                            if (input.match(/(công nghệ|tech|ai)/)) ans += careerData.methodology.detailed.tech + '\n';
                            if (input.match(/(đánh giá|assessment)/)) ans += careerData.methodology.detailed.assessment + '\n';
                            if (ans === '🎯 Phương pháp giảng dạy hiện đại:\n') {
                                ans += careerData.methodology.detailed.active + '\n' + careerData.methodology.detailed.tech + '\n' + careerData.methodology.detailed.assessment + '\n';
                            }
                            return ans;
                        }
                    }
                    // Quản lý lớp học
                    if (input.includes('lớp học') || input.includes('classroom') || input.includes('quản lý')) {
                        let ans = '';
                        if (careerData.classroom) {
                            ans += '📋 Quản lý lớp học hiệu quả:\n';
                            if (input.match(/(quy tắc|rules)/)) ans += careerData.classroom.detailed.rules + '\n';
                            if (input.match(/(môi trường|environment)/)) ans += careerData.classroom.detailed.environment + '\n';
                            if (input.match(/(giao tiếp|communication)/)) ans += careerData.classroom.detailed.communication + '\n';
                            if (ans === '📋 Quản lý lớp học hiệu quả:\n') {
                                ans += careerData.classroom.detailed.rules + '\n' + careerData.classroom.detailed.environment + '\n' + careerData.classroom.detailed.communication + '\n';
                            }
                            return ans;
                        }
                    }
                    // Chương trình giảng dạy
                    if (input.includes('chương trình') || input.includes('curriculum') || input.includes('kế hoạch')) {
                        let ans = '';
                        if (careerData.curriculum) {
                            ans += '📝 Thiết kế chương trình giảng dạy:\n';
                            if (input.match(/(kế hoạch|planning)/)) ans += careerData.curriculum.detailed.planning + '\n';
                            if (input.match(/(phân hóa|differentiation)/)) ans += careerData.curriculum.detailed.differentiation + '\n';
                            if (input.match(/(tích hợp|integration)/)) ans += careerData.curriculum.detailed.integration + '\n';
                            if (ans === '📝 Thiết kế chương trình giảng dạy:\n') {
                                ans += careerData.curriculum.detailed.planning + '\n' + careerData.curriculum.detailed.differentiation + '\n' + careerData.curriculum.detailed.integration + '\n';
                            }
                            return ans;
                        }
                    }
                }
                
                if (currentCareer === 'developer') {
                    // Frontend
                    if (input.includes('frontend') || input.includes('react') || input.includes('vue') || input.includes('angular')) {
                        let ans = '';
                        if (careerData.frontend) {
                            ans += '⚛️ Frontend Development:\n';
                            if (input.match(/(framework|react|vue|angular)/)) ans += careerData.frontend.detailed.frameworks + '\n';
                            if (input.match(/(tool|công cụ|webpack)/)) ans += careerData.frontend.detailed.tools + '\n';
                            if (input.match(/(tối ưu|optimization|performance)/)) ans += careerData.frontend.detailed.optimization + '\n';
                            if (ans === '⚛️ Frontend Development:\n') {
                                ans += careerData.frontend.detailed.frameworks + '\n' + careerData.frontend.detailed.tools + '\n' + careerData.frontend.detailed.optimization + '\n';
                            }
                            return ans;
                        }
                    }
                    // Backend
                    if (input.includes('backend') || input.includes('api') || input.includes('database')) {
                        let ans = '';
                        if (careerData.backend) {
                            ans += '🐍 Backend Development:\n';
                            if (input.match(/(ngôn ngữ|language|python|java)/)) ans += careerData.backend.detailed.languages + '\n';
                            if (input.match(/(database|sql|mongodb)/)) ans += careerData.backend.detailed.databases + '\n';
                            if (input.match(/(kiến trúc|architecture|microservice)/)) ans += careerData.backend.detailed.architecture + '\n';
                            if (ans === '🐍 Backend Development:\n') {
                                ans += careerData.backend.detailed.languages + '\n' + careerData.backend.detailed.databases + '\n' + careerData.backend.detailed.architecture + '\n';
                            }
                            return ans;
                        }
                    }
                    // DevOps
                    if (input.includes('devops') || input.includes('deploy') || input.includes('cloud')) {
                        let ans = '';
                        if (careerData.devops) {
                            ans += '🔄 DevOps & Cloud:\n';
                            if (input.match(/(ci|cd|pipeline|jenkins)/)) ans += careerData.devops.detailed.ci_cd + '\n';
                            if (input.match(/(cloud|aws|azure|gcp)/)) ans += careerData.devops.detailed.cloud + '\n';
                            if (input.match(/(security|bảo mật|authentication)/)) ans += careerData.devops.detailed.security + '\n';
                            if (ans === '🔄 DevOps & Cloud:\n') {
                                ans += careerData.devops.detailed.ci_cd + '\n' + careerData.devops.detailed.cloud + '\n' + careerData.devops.detailed.security + '\n';
                            }
                            return ans;
                        }
                    }
                }

                if (currentCareer === 'office') {
                    // Email
                    if (input.includes('email') || input.includes('thư điện tử') || input.includes('viết mail')) {
                        let ans = '📧 Hướng dẫn viết email chuyên nghiệp:\n';
                        if (careerData.email) {
                            if (input.match(/(tiêu đề|subject)/)) ans += careerData.email.detailed.subject + '\n';
                            if (input.match(/(chào|greeting)/)) ans += careerData.email.detailed.greeting + '\n';
                            if (input.match(/(nội dung|body)/)) ans += careerData.email.detailed.body + '\n';
                            if (input.match(/(kết|chữ ký|closing|signature)/)) ans += careerData.email.detailed.closing + '\n';
                            if (ans === '📧 Hướng dẫn viết email chuyên nghiệp:\n') {
                                ans += careerData.email.detailed.subject + '\n' + careerData.email.detailed.greeting + '\n' + careerData.email.detailed.body + '\n' + careerData.email.detailed.closing + '\n';
                            }
                            return ans;
                        }
                    }
                    // Họp
                    if (input.includes('họp') || input.includes('meeting') || input.includes('tổ chức họp')) {
                        let ans = '📅 Hướng dẫn tổ chức cuộc họp hiệu quả:\n';
                        if (careerData.meeting) {
                            if (input.match(/(trước|chuẩn bị|before)/)) ans += careerData.meeting.detailed.before + '\n';
                            if (input.match(/(trong|during)/)) ans += careerData.meeting.detailed.during + '\n';
                            if (input.match(/(sau|after)/)) ans += careerData.meeting.detailed.after + '\n';
                            if (ans === '📅 Hướng dẫn tổ chức cuộc họp hiệu quả:\n') {
                                ans += careerData.meeting.detailed.before + '\n' + careerData.meeting.detailed.during + '\n' + careerData.meeting.detailed.after + '\n';
                            }
                            return ans;
                        }
                    }
                    // Quản lý thời gian
                    if (input.includes('thời gian') || input.includes('time management') || input.includes('pomodoro') || input.includes('quản lý công việc')) {
                        let ans = '⏱️ Mẹo quản lý thời gian hiệu quả:\n';
                        if (careerData.timeManagement) {
                            if (input.match(/(eisenhower|ma trận)/)) ans += careerData.timeManagement.detailed.matrix + '\n';
                            if (input.match(/(pomodoro)/)) ans += careerData.timeManagement.detailed.pomodoro + '\n';
                            if (input.match(/(kế hoạch|planning|to-do)/)) ans += careerData.timeManagement.detailed.planning + '\n';
                            if (ans === '⏱️ Mẹo quản lý thời gian hiệu quả:\n') {
                                ans += careerData.timeManagement.detailed.matrix + '\n' + careerData.timeManagement.detailed.pomodoro + '\n' + careerData.timeManagement.detailed.planning + '\n';
                            }
                            return ans;
                        }
                    }
                    // Excel
                    if (input.includes('excel') || input.includes('hàm') || input.includes('vlookup') || input.includes('pivot')) {
                        let ans = '📊 Mẹo và hàm Excel thông dụng:\n';
                        if (careerData.excel) {
                            if (input.match(/(hàm|function)/)) ans += careerData.excel.detailed.functions + '\n';
                            if (input.match(/(phím tắt|shortcut)/)) ans += careerData.excel.detailed.shortcuts + '\n';
                            if (input.match(/(mẹo|tip)/)) ans += careerData.excel.detailed.tips + '\n';
                            if (ans === '📊 Mẹo và hàm Excel thông dụng:\n') {
                                ans += careerData.excel.detailed.functions + '\n' + careerData.excel.detailed.shortcuts + '\n' + careerData.excel.detailed.tips + '\n';
                            }
                            return ans;
                        }
                    }
                }

                // Check for keywords in a specific order
                if (careerData.strategy && (input.includes('kinh doanh') || input.includes('chiến lược'))) {
                     return careerData.strategy[Math.floor(Math.random() * careerData.strategy.length)];
                }
                if (careerData.pest && (input.includes('sâu bệnh') || input.includes('phòng bệnh'))) {
                     return careerData.pest[Math.floor(Math.random() * careerData.pest.length)];
                }
                if (careerData.legal && (input.includes('luật') || input.includes('pháp lý'))) {
                     return careerData.legal[Math.floor(Math.random() * careerData.legal.length)];
                }
                if (careerData.general) {
                     return careerData.general[Math.floor(Math.random() * careerData.general.length)];
                }
            }

            // Default fallback response
            return `Dạ, cảm ơn câu hỏi của ${name}. Cháu đã ghi nhận thông tin và sẽ học hỏi thêm để có thể hỗ trợ chú/cô tốt hơn trong tương lai ạ.`;
        }

        function addQuickMessage(text) {
            if (!isTyping) {
                addMessage(text, true);
                
                isTyping = true;
                addTypingIndicator();
                
                setTimeout(() => {
                    removeTypingIndicator();
                    const response = generateAIResponse(text);
                    addMessage(response, false);
                    isTyping = false;
                }, 1500);
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function showSuggestionButtons() {
            console.log('showSuggestionButtons called'); // Debug log
            
            const name = userProfile.name || (currentCareer === 'farmer' ? 'chú/cô' : 'bạn');
            const suggestions = getSuggestions(currentCareer);
            const messagesContainer = document.getElementById('messages');
            
            console.log('name:', name); // Debug log
            console.log('suggestions:', suggestions); // Debug log
            console.log('messagesContainer:', messagesContainer); // Debug log

            // Add a title message
            const titleDiv = document.createElement('div');
            titleDiv.className = 'flex justify-start';
            const titleBubble = document.createElement('div');
            titleBubble.className = 'message-bubble px-4 py-3 rounded-2xl shadow-sm bg-gray-100 border border-gray-200';
            let officeSuggestions = [
                '✉️ Gợi ý viết mail chuyên nghiệp',
                '🗂️ Cách sắp xếp timeline công việc',
                '📅 Lập kế hoạch tuần hiệu quả',
                '⏱️ Mẹo quản lý thời gian',
                '📊 Hàm Excel thông dụng cho văn phòng'
            ];
            if (currentCareer === 'office') {
                titleBubble.innerHTML = `<p class="text-sm text-gray-700 font-medium">Các chủ đề bạn có thể hỏi trợ lý văn phòng:</p>`;
            }
            else {
            titleBubble.innerHTML = `<p class="text-sm text-gray-700 font-medium">Đây là một vài điều tôi có thể giúp ${name}. Hãy chọn một nhé:</p>`;
            }
            titleDiv.appendChild(titleBubble);
            messagesContainer.appendChild(titleDiv);
            // Add suggestion buttons
            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'flex flex-wrap gap-2 mt-3 justify-start';
            buttonContainer.id = 'suggestion-buttons';
            (currentCareer === 'office' ? officeSuggestions : suggestions).forEach(suggestion => {
                const button = document.createElement('button');
                button.className = 'px-3 py-2 bg-blue-100 hover:bg-blue-200 text-blue-800 text-sm font-semibold rounded-lg transition-colors duration-200 border border-blue-200';
                button.textContent = suggestion;
                button.onclick = () => {
                    console.log('Button clicked:', suggestion); // Debug log
                    handleSuggestionClick(suggestion);
                };
                buttonContainer.appendChild(button);
            });
            messagesContainer.appendChild(buttonContainer);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            console.log('Suggestion buttons added successfully'); // Debug log
        }

        function handleSuggestionClick(suggestion) {
            console.log('Button clicked:', suggestion); // Debug log
            
            // Remove buttons
            const buttonContainer = document.getElementById('suggestion-buttons');
            if (buttonContainer) {
                buttonContainer.remove();
            }

            addMessage(suggestion, true);

            // Get AI response
            setTimeout(() => {
                console.log('Getting response for:', suggestion); // Debug log
                const response = getSuggestionResponse(suggestion);
                console.log('Response:', response); // Debug log
                addMessage(response, false);
            }, 500);
        }

        function getSuggestions(career) {
            const suggestions = {
                farmer: [
                    '🌾 Trồng lúa miền Tây',
                    '🌶️ Bệnh cây ớt vàng lá',
                    '🐔 Gà thả vườn bị bệnh',
                    '🍈 Kỹ thuật trồng dưa lưới',
                    '🌸 Sầu riêng ra hoa bón phân',
                    '☕ Nhắc bón phân cà phê',
                    '💰 Cập nhật giá nông sản',
                    '🌤️ Dự báo thời tiết nông vụ',
                    '🌿 Kỹ thuật diệt cỏ hiệu quả'
                ],
                business: [
                    'Phân tích thị trường & đối thủ',
                    'Xây dựng kế hoạch kinh doanh',
                    'Tư vấn marketing & bán hàng',
                    'Gợi ý tối ưu chi phí'
                ],
                teacher: [
                    'Soạn giáo án sáng tạo',
                    'Tư vấn phương pháp giảng dạy',
                    'Hỗ trợ quản lý lớp học',
                    'Gợi ý công cụ AI trong giáo dục'
                ],
                developer: [
                    'Hỗ trợ tìm và sửa lỗi (debug)',
                    'Gợi ý tối ưu hóa code',
                    'Giải thích khái niệm & công nghệ',
                    'Tư vấn về kiến trúc phần mềm'
                ],
                sales: [
                
                        '📝 Viết bài post review sản phẩm thu hút',
                        '🎥 Quay/chụp sản phẩm hấp dẫn',
                        '💰 Định giá sản phẩm hợp lý',
                        '💬 Cách nói chuyện với khách hàng',
                        '🤝 Xử lý khách hàng trả giá'
                 
                ],
                office: [
                    'Quản lý tài liệu: 1) Sắp xếp và phân loại tài liệu hiệu quả, 2) Sử dụng các công cụ quản lý tài liệu, 3) Bảo mật thông tin quan trọng, 4) Tối ưu hóa quy trình tìm kiếm tài liệu.',
                    'Lập kế hoạch công việc: 1) Phân tích nhu cầu công việc, 2) Lập kế hoạch chi tiết và thực hiện, 3) Đánh giá tiến độ và điều chỉnh, 4) Tạo môi trường làm việc hiệu quả.',
                    'Giao tiếp nội bộ: 1) Lắng nghe tích cực, 2) Phản hồi kịp thời, 3) Tạo môi trường làm việc thân thiện, 4) Xây dựng mối quan hệ lâu dài với đồng nghiệp.',
                    'Công cụ văn phòng: 1) Sử dụng các phần mềm văn phòng hiệu quả, 2) Tối ưu hóa quy trình làm việc, 3) Tạo môi trường làm việc hiệu quả, 4) Quản lý thông tin và tài liệu.'
                ],
                other: [
                    'Tìm kiếm & tổng hợp thông tin',
                    'Lên kế hoạch & quản lý công việc',
                    'Tư vấn phát triển kỹ năng',
                    'Brainstorm ý tưởng mới'
                ]
            };
            return suggestions[career] || suggestions.other;
        }

        function getSuggestionResponse(problem) {
            console.log('getSuggestionResponse called with:', problem); // Debug log
            console.log('currentCareer:', currentCareer); // Debug log
            
            const name = userProfile.name || 'Bạn';
            let response = '';
             switch(currentCareer) {
                case 'farmer':
                    console.log('Processing farmer case'); // Debug log
                    switch(problem) {
                        case '🌾 Trồng lúa miền Tây':
                            response = `Dạ, về trồng lúa ở miền Tây, cháu sẽ hướng dẫn chú/cô chi tiết về bón phân và chăm sóc hiệu quả ạ.`;
                            break;
                        case '🌶️ Bệnh cây ớt vàng lá':
                            response = `Dạ, về cây ớt bị vàng lá và rụng trái, có thể do nấm hoặc thiếu dinh dưỡng. Cháu sẽ hướng dẫn chú/cô cách xử lý ạ.`;
                            break;
                        case '🐔 Gà thả vườn bị bệnh':
                            response = `Dạ, về gà thả vườn ăn ít và tiêu chảy, có thể do bệnh hoặc thức ăn. Cháu sẽ hướng dẫn chú/cô cách xử lý ạ.`;
                            break;
                        case '🍈 Kỹ thuật trồng dưa lưới':
                            response = `Dạ, dưa lưới là cây trồng có giá trị kinh tế cao. Cháu sẽ hướng dẫn chú/cô kỹ thuật trồng dưa lưới từ A-Z để đạt năng suất tối ưu ạ.`;
                            break;
                        case '🌸 Sầu riêng ra hoa bón phân':
                            response = `Dạ, về cây sầu riêng giai đoạn ra hoa, cháu sẽ hướng dẫn chú/cô loại phân phù hợp ạ.`;
                            break;
                        case '☕ Nhắc bón phân cà phê':
                            response = `Dạ, về cây cà phê, cháu sẽ nhắc chú/cô bón phân định kỳ vào sáng thứ Bảy hàng tuần ạ.`;
                            break;
                        case '💰 Cập nhật giá nông sản':
                            response = `Dạ, về giá nông sản, cháu sẽ cập nhật thông tin mới nhất cho chú/cô ạ.`;
                            break;
                        case '🌤️ Dự báo thời tiết nông vụ':
                            response = `Để xem dự báo thời tiết, vui lòng cho tôi biết tỉnh/thành phố của bạn.\n_(Lưu ý: Đây là dữ liệu giả lập. Trong phiên bản chính thức sẽ kết nối nguồn khí tượng thực tế)._`;
                            break;
                        case '🌿 Kỹ thuật diệt cỏ hiệu quả':
                            response = `🌿 Kỹ thuật diệt cỏ hiệu quả:\n\n👨‍🌾 Diệt cỏ thủ công:\n• Nhổ cỏ bằng tay: Hiệu quả, an toàn\n• Cắt cỏ bằng liềm: Nhanh, tiết kiệm\n• Làm cỏ định kỳ: 2-3 lần/vụ\n• Thời điểm: Sáng sớm hoặc chiều mát\n\n🧪 Thuốc diệt cỏ:\n• Glyphosate: Diệt cỏ toàn diện\n• 2,4-D: Diệt cỏ lá rộng\n• Paraquat: Diệt cỏ tiếp xúc\n• Lưu ý: Đọc kỹ hướng dẫn, bảo hộ đầy đủ\n\n🌱 Diệt cỏ hữu cơ:\n• Muối: Rải muối vào gốc cỏ\n• Giấm: Phun giấm trắng 5%\n• Nước sôi: Đổ nước sôi vào gốc\n• Che phủ: Dùng bạt, rơm rạ\n\n🛡️ Phòng ngừa cỏ:\n• Trồng dày: Giảm ánh sáng đến đất\n• Che phủ: Rơm rạ, bạt nilon\n• Luân canh: Thay đổi cây trồng\n• Vệ sinh: Dọn sạch cỏ quanh vườn`;
                            break;
                        default:
                            console.log('No matching case found for:', problem); // Debug log
                            response = `Tôi sẵn sàng hỗ trợ. ${name} vui lòng cho tôi biết thêm chi tiết về vấn đề này.`;
                    }
                    break;

                case 'saler':
                    console.log('Processing saler case'); // Debug log
                    switch(problem) {
                        case 'Bí quyết chốt đơn hiệu quả':
                        esponse = `Một số bí quyết giúp bạn chốt đơn thành công:
                                - Lắng nghe kỹ nhu cầu và vấn đề của khách hàng
                                - Tư vấn đúng trọng tâm, nhấn mạnh lợi ích sản phẩm phù hợp với khách
                                - Tạo cảm giác cấp bách (ưu đãi giới hạn, số lượng có hạn...)
                                - Giải đáp mọi thắc mắc, xử lý từ chối một cách nhẹ nhàng
                                - Đưa ra lời kêu gọi hành động rõ ràng: "Chốt đơn ngay hôm nay để nhận ưu đãi!"`;
                    break;
                    case 'Chăm sóc khách hàng sau bán':
                    response = `Chăm sóc khách hàng sau bán giúp tăng sự hài lòng và giữ chân khách:
                        - Gửi lời cảm ơn sau khi khách mua hàng
                        - Hỏi thăm trải nghiệm sử dụng sản phẩm, chủ động hỗ trợ nếu có vấn đề
                        - Gửi ưu đãi, thông tin sản phẩm mới cho khách cũ
                        - Xây dựng mối quan hệ thân thiết, tạo sự tin tưởng lâu dài`;
                    break;
                case 'Quản lý đơn hàng và tồn kho thông minh':
                    response = `Để quản lý đơn hàng và tồn kho hiệu quả:
                        - Sử dụng sổ sách, file Excel hoặc phần mềm quản lý bán hàng để theo dõi đơn và tồn kho
                        - Xác nhận đơn hàng nhanh chóng, cập nhật trạng thái cho khách
                        - Kiểm tra tồn kho định kỳ, tránh hết hàng hoặc tồn kho quá lâu
                        - Phân loại sản phẩm theo nhóm để dễ kiểm soát và lên kế hoạch nhập hàng hợp lý`;
                    break;
                    case 'Quản lý đơn hàng và tồn kho thông minh':
                    response = `Để quản lý đơn hàng và tồn kho hiệu quả:
- Sử dụng sổ sách, file Excel hoặc phần mềm quản lý bán hàng để theo dõi đơn và tồn kho
- Xác nhận đơn hàng nhanh chóng, cập nhật trạng thái cho khách
- Kiểm tra tồn kho định kỳ, tránh hết hàng hoặc tồn kho quá lâu
- Phân loại sản phẩm theo nhóm để dễ kiểm soát và lên kế hoạch nhập hàng hợp lý`;
                    break;
                default:
                    response = `Tôi sẵn sàng hỗ trợ. ${name} vui lòng cho tôi biết thêm chi tiết về vấn đề này.`;
            }
                case 'business':
                     switch(problem) {
                        case 'Phân tích thị trường & đối thủ':
                            response = `Để phân tích, vui lòng cung cấp cho tôi thông tin về ngành hàng và một vài đối thủ chính của ${name}.`;
                            break;
                        case 'Xây dựng kế hoạch kinh doanh':
                            response = `Xây dựng kế hoạch kinh doanh là một bước quan trọng. Chúng ta có thể bắt đầu bằng việc xác định mục tiêu, thị trường, sản phẩm và chiến lược marketing. ${name} muốn bắt đầu với phần nào trước?`;
                            break;
                        case 'Tư vấn marketing & bán hàng':
                            response = `Chắc chắn rồi. ${name} đang quan tâm đến marketing online (Facebook, Google), marketing tại điểm bán hay kênh nào khác?`;
                            break;
                        case 'Gợi ý tối ưu chi phí':
                            response = `Để tối ưu chi phí, chúng ta có thể rà soát các khoản chi cho vận hành, nhân sự, marketing... ${name} có muốn xem qua một checklist các hạng mục cần tối ưu không?`;
                            break;
                        default:
                            response = `Tôi sẵn sàng hỗ trợ. ${name} vui lòng cho tôi biết thêm chi tiết về vấn đề này.`;
                    }
                    break;
                case 'office':
                    switch(problem) {
                        case '✉️ Gợi ý viết mail chuyên nghiệp':
                            response = `✉️ **Gợi ý viết mail chuyên nghiệp:**\n\n- Tiêu đề rõ ràng, ngắn gọn (VD: [ACTION] Yêu cầu báo cáo tuần)\n- Lời chào trang trọng: "Kính gửi Anh/Chị..."\n- Nội dung: Trình bày mạch lạc, chia đoạn, gạch đầu dòng\n- Kết thúc: "Trân trọng,", "Best regards,"\n- Chữ ký: Họ tên, chức vụ, công ty, số điện thoại\n\n**Mẹo:** Luôn kiểm tra lại lỗi chính tả và tệp đính kèm trước khi gửi!`;
                            break;
                        case '🗂️ Cách sắp xếp timeline công việc':
                            response = `🗂️ **Cách sắp xếp timeline công việc:**\n\n1. Liệt kê tất cả các đầu việc cần làm\n2. Ưu tiên theo mức độ quan trọng/khẩn cấp (Ma trận Eisenhower)\n3. Chia nhỏ công việc lớn thành các bước nhỏ\n4. Sử dụng công cụ: Google Calendar, Trello, Notion...\n5. Đặt deadline rõ ràng cho từng nhiệm vụ\n6. Đánh giá lại tiến độ mỗi cuối ngày/tuần`;
                            break;
                        case '📅 Lập kế hoạch tuần hiệu quả':
                            response = `📅 **Lập kế hoạch tuần hiệu quả:**\n\n- Đầu tuần: Xác định 3 mục tiêu lớn nhất\n- Chia nhỏ mục tiêu thành các task hàng ngày\n- Sắp xếp lịch họp, deadline, công việc cá nhân\n- Để thời gian dự phòng cho việc phát sinh\n- Cuối tuần: Tổng kết, rút kinh nghiệm, điều chỉnh kế hoạch tuần sau`;
                            break;
                        case '⏱️ Mẹo quản lý thời gian':
                            response = `⏱️ **Mẹo quản lý thời gian:**\n\n- Kỹ thuật Pomodoro: 25 phút tập trung, 5 phút nghỉ\n- Time blocking: Chia khung giờ cho từng loại việc\n- Ưu tiên việc quan trọng trước (Eat That Frog)\n- Hạn chế đa nhiệm, tắt thông báo khi làm việc\n- Tổng kết cuối ngày để điều chỉnh thói quen`;
                            break;
                        case '📊 Hàm Excel thông dụng cho văn phòng':
                            response = `📊 **Hàm Excel thông dụng:**\n\n- SUM, AVERAGE, COUNT: Tính tổng, trung bình, đếm\n- IF: Hàm điều kiện\n- VLOOKUP/HLOOKUP: Tìm kiếm dữ liệu\n- CONCATENATE: Nối chuỗi\n- PIVOTTABLE: Tổng hợp, phân tích dữ liệu\n\n**Phím tắt hay:** Ctrl+T (tạo bảng), Ctrl+Shift+L (lọc), Alt+= (AutoSum)`;
                            break;
                    default:
                            response = `Tôi sẵn sàng hỗ trợ. ${name} vui lòng cho tôi biết thêm chi tiết về vấn đề này.`;
                    }
                    break;
// ... existing code ...
            }
            return response;
        }
    </script>
</body>
</html>
